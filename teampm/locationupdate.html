<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA==" crossorigin="anonymous"
        referrerpolicy="no-referrer"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Prompt&display=swap" rel="stylesheet">
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <script src='https://unpkg.com/tesseract.js@4.0.2/dist/tesseract.min.js'></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Prompt', sans-serif;
        }

        img#profile {
            width: 60px;
            height: 60px;
            object-fit: cover;
        }
    </style>
</head>

<body>
    <nav class="navbar bg-light">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="#">
                <img src="https://www.appdisqus.com/wp-content/uploads/2015/02/despicable_me_2_minions-1920x1080.jpg" alt="profile" id="profile" class="rounded-circle border d-inline-block align-text-top">
                &nbsp; <div>
                    <span id="displayName">Team PM</span>
                </div>
            </a>
        </div>
    </nav>
    <div class="container">
        <div class="row justify-contain-center py-3 g-3">
            <div class="col-12 text-center">
                <label for="team" class="h3 fw-bold text-primary">TEAM</label>
                <select name="team" id="team" class="form-select text-center">
                    <option value="" selected disabled>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°</option>
                    <option value="team PM">team PM</option>
                    <option value="team CAL">team CAL</option>
                    <option value="VENDER">VENDER</option>
                </select>
            </div>
            <div class="col-12 text-center">
                <label for="dept" class="h3 fw-bold text-success">‡πÅ‡∏ú‡∏ô‡∏Å</label>
                <select type="text" class="form-select text-center" id="dept">
                    <option value="" selected disabled>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å</option>
                    <option value="ANESTHESIA (‡∏ß‡∏¥‡∏™‡∏±‡∏ç‡∏ç‡∏µ)">ANESTHESIA (‡∏ß‡∏¥‡∏™‡∏±‡∏ç‡∏ç‡∏µ)</option>
                    <option value="ART-LAB (‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏ö‡∏∏‡∏ï‡∏£‡∏¢‡∏≤‡∏Å)">ART-LAB (‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏ö‡∏∏‡∏ï‡∏£‡∏¢‡∏≤‡∏Å)</option>
                    <option value="BME-PYT3">BME-PYT3</option>
                    <option value="CATH-LAB">CATH-LAB</option>
                    <option value="CHECK-UP (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û)">CHECK-UP (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û)</option>
                    <option value="CORPORATE CUSTOMER SERVICE">CORPORATE CUSTOMER SERVICE</option>
                    <option value="CSSD (‡∏à‡πà‡∏≤‡∏¢‡∏Å‡∏•‡∏≤‡∏á)">CSSD (‡∏à‡πà‡∏≤‡∏¢‡∏Å‡∏•‡∏≤‡∏á)</option>
                    <option value="DENTAL (‡∏ó‡∏±‡∏ô‡∏ï‡∏Å‡∏£‡∏£‡∏°)">DENTAL (‡∏ó‡∏±‡∏ô‡∏ï‡∏Å‡∏£‡∏£‡∏°)</option>
                    <option value="DIABETIC&amp;METABOLIC(‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô)">DIABETIC&amp;METABOLIC(‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô)</option>
                    <option value="EENT( ‡∏´‡∏π‡∏ï‡∏≤‡∏Ñ‡∏≠‡∏à‡∏°‡∏π‡∏Å)">EENT( ‡∏´‡∏π‡∏ï‡∏≤‡∏Ñ‡∏≠‡∏à‡∏°‡∏π‡∏Å)</option>
                    <option value="EMERGENCY( ‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô)">EMERGENCY( ‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô)</option>
                    <option value="GASTROINTESTINAL LABORATORY(GI)">GASTROINTESTINAL LABORATORY(GI)</option>
                    <option value="HEMODIALYSIS (‡πÑ‡∏ï‡πÄ‡∏ó‡∏µ‡∏¢‡∏°)">HEMODIALYSIS (‡πÑ‡∏ï‡πÄ‡∏ó‡∏µ‡∏¢‡∏°)</option>
                    <option value="HOPD CENTER (‡∏®‡∏∏‡∏ô‡∏¢‡πå‡∏°‡∏∞‡πÄ‡∏£‡πá‡∏á)">HOPD CENTER (‡∏®‡∏∏‡∏ô‡∏¢‡πå‡∏°‡∏∞‡πÄ‡∏£‡πá‡∏á)</option>
                    <option value="INFECTION CONTROL ( IC)">INFECTION CONTROL ( IC)</option>
                    <option value="INTENSIVE CARE UNIT(‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏´‡∏ô‡∏±‡∏Å)">INTENSIVE CARE UNIT(‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏´‡∏ô‡∏±‡∏Å)</option>
                    <option value="LABOR ROOM(‡∏´‡πâ‡∏≠‡∏á‡∏Ñ‡∏•‡∏≠‡∏î)">LABOR ROOM(‡∏´‡πâ‡∏≠‡∏á‡∏Ñ‡∏•‡∏≠‡∏î)</option>
                    <option value="LABORATORY">LABORATORY</option>
                    <option value="MAID">MAID</option>
                    <option value="MARKETING">MARKETING</option>
                    <option value="NURSERY(‡πÄ‡∏î‡πá‡∏Å‡∏≠‡πà‡∏≠‡∏ô)">NURSERY(‡πÄ‡∏î‡πá‡∏Å‡∏≠‡πà‡∏≠‡∏ô)</option>
                    <option value="NURSING DEPARTMENT">NURSING DEPARTMENT</option>
                    <option value="OBSERVE(‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏≠‡∏≤‡∏Å‡∏≤‡∏£)">OBSERVE(‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏≠‡∏≤‡∏Å‡∏≤‡∏£)</option>
                    <option value="OPD CARDIO(‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏´‡∏±‡∏ß‡πÉ‡∏à)">OPD CARDIO(‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏´‡∏±‡∏ß‡πÉ‡∏à)</option>
                    <option value="OPD COUNTER NURSE (CN ‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á)">OPD COUNTER NURSE (CN ‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á)</option>
                    <option value="OPD HEAD NECK BREAST(‡∏®‡∏∏‡∏ô‡∏¢‡πå‡πÄ‡∏ï‡πâ‡∏≤‡∏ô‡∏°)">OPD HEAD NECK BREAST(‡∏®‡∏∏‡∏ô‡∏¢‡πå‡πÄ‡∏ï‡πâ‡∏≤‡∏ô‡∏°)</option>
                    <option value="OPD MEDICINE(‡∏≠‡∏≤‡∏¢‡∏∏‡∏Å‡∏£‡∏£‡∏°)">OPD MEDICINE(‡∏≠‡∏≤‡∏¢‡∏∏‡∏Å‡∏£‡∏£‡∏°)</option>
                    <option value="OPD NEURO (‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏™‡∏°‡∏≠‡∏á)">OPD NEURO (‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏™‡∏°‡∏≠‡∏á)</option>
                    <option value="OPD OB/GYN(‡∏®‡∏∏‡∏ô‡∏¢‡πå‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏´‡∏ç‡∏¥‡∏á)">OPD OB/GYN(‡∏®‡∏∏‡∏ô‡∏¢‡πå‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏´‡∏ç‡∏¥‡∏á)</option>
                    <option value="OPD PEDIATRIC( ‡πÅ‡∏ú‡∏ô‡∏Å‡πÄ‡∏î‡πá‡∏Å)">OPD PEDIATRIC( ‡πÅ‡∏ú‡∏ô‡∏Å‡πÄ‡∏î‡πá‡∏Å)</option>
                    <option value="OPD SURGERY(‡∏®‡∏±‡∏•‡∏¢‡∏Å‡∏£‡∏£‡∏°)">OPD SURGERY(‡∏®‡∏±‡∏•‡∏¢‡∏Å‡∏£‡∏£‡∏°)</option>
                    <option value="OPD UROLOGY (‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞)">OPD UROLOGY (‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞)</option>
                    <option value="OPERATING ROOM(‡∏´‡πâ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î)">OPERATING ROOM(‡∏´‡πâ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î)</option>
                    <option value="PHARMARCY(‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£‡∏£‡∏° ‡∏´‡πâ‡∏≠‡∏á‡∏¢‡∏≤)">PHARMARCY(‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£‡∏£‡∏° ‡∏´‡πâ‡∏≠‡∏á‡∏¢‡∏≤)</option>
                    <option value="PHYATHAI BEAUTY CENTER (PBC ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡∏≤‡∏°)">PHYATHAI BEAUTY CENTER (PBC ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡∏≤‡∏°)</option>
                    <option value="PHYSICAL THERAPY( ‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û)">PHYSICAL THERAPY( ‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û)</option>
                    <option value="PICU">PICU</option>
                    <option value="PWA LIFE CENTER">PWA LIFE CENTER</option>
                    <option value="PWA ‡∏ä‡∏∞‡∏•‡∏≠‡∏ß‡∏±‡∏¢">PWA ‡∏ä‡∏∞‡∏•‡∏≠‡∏ß‡∏±‡∏¢</option>
                    <option value="VEHICLE">VEHICLE</option>
                    <option value="WARD 7">WARD 7</option>
                    <option value="WARD 8">WARD 8</option>
                    <option value="WARD 9">WARD 9</option>
                    <option value="WARD 10">WARD 10</option>
                    <option value="WARD 11">WARD 11</option>
                    <option value="WARD 12">WARD 12</option>
                    <option value="WARD 14">WARD 14</option>
                    <option value="WARD 15">WARD 15</option>
                    <option value="WARD 17">WARD 17</option>
                    <option value="FLOOR 19">FLOOR 19</option>
                    <option value="FLOOR 20">FLOOR 20</option>
                    <option value="WAREHOUSE">WAREHOUSE</option>
                    <option value="X-RAY">X-RAY</option>
                    <option value="‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á">‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á</option>
                </select>
            </div>
            <div class="col-12 mt-3">
                <input type="text" id="remark" class="form-control" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á/‡πÄ‡∏•‡∏Ç‡∏´‡πâ‡∏≠‡∏á/‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á/‡∏≠‡∏∑‡πà‡∏ô‡πÜ" autocomplete="on">
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="col-12 flex-fill mb-2">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="" id="isDemo">
                    <label class="form-check-label" for="isDemo">
                        Demo
                    </label>
                </div>
            </div>
            <div class="col-auto flex-fill mb-2 pe-0">
                <input type="text" id="add-id" name="add-id" class="form-control text-center text-bg-warning shadow-none" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™">
            </div>
            <div class="col-auto text-center mb-2">
                <button class="btn btn-info" id="ocr-btn"><i class="bi bi-upc-scan"></i>&nbsp;OCR</button>
            </div>
            <div class="col-auto text-center mb-2">
                <button class="btn btn-primary" style="min-width: 100px;" id="add-btn">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏´‡∏±‡∏™</button>
            </div>

        </div>
        <section id="id-sec">

        </section>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="staticBackdropLabel">OCR Code</h1>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
                <div class="modal-body">
                    <div>
                        <video id="video" class="img-fluid rounded" width="100%" autoplay></video>
                        <div class="row justift-centent-center">
                            <div class="col text-center">
                                <button id="snap" class="btn btn-lg btn-info"><i class="bi bi-camera"></i>&nbsp; ‡∏≠‡πà‡∏≤‡∏ô‡∏†‡∏≤‡∏û</button>
                            </div>
                        </div>
                        <canvas id="canvas" hidden></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>
    <script>
        // VConsole will be exported to `window.VConsole` by default.
        //var vConsole = new window.VConsole();
    </script>
    <script>
        var arr = []
        var Toast, profile
        $(document).ready(() => {

             liff.init({
                 liffId: '1657539607-EPzqza2K',
                 withLoginOnExternalBrowser: true
             })
            liff.ready.then(async () => {
                $('#dept').select2({
                    theme: 'bootstrap-5'
                });
                profile = await liff.getProfile()
                $('#profile').attr('src', profile.pictureUrl)
                $('#displayName').text(profile.displayName)
                Toast = Swal.mixin({
                    toast: true,
                    position: 'top',
                    showConfirmButton: false,
                    timer: 1500,
                    timerProgressBar: true,
                })

                var options = {
                    onComplete: function (cep) {
                        if (arr.includes(cep)) {
                            return Toast.fire({
                                icon: 'warning',
                                title: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß'
                            })
                        }
                        appendPill(cep)
                    },
                };
                $('#add-id').mask('PYT3_00000', options);
                $('#isDemo').change(function () {
                    $('#add-id').unmask();
                    $('#add-id').val('');
                    $('#add-id').focus();
                    if ($(this).is(':checked')) {
                        $('#add-id').mask('DEMO_000000', options);
                    } else {
                        $('#add-id').mask('PYT3_00000', options);
                    }

                })
            })

            $('#ocr-btn').click(function () {
                $('#staticBackdrop').modal('show')
            })

        })

        $('#staticBackdrop').on('show.bs.modal', function () {
            navigator.mediaDevices.getUserMedia({
                video: {
                    facingMode: 'environment',
                    zoom: 2,
                    width: { ideal: 720, max: 1280 },
                    height: { ideal: 720, max: 1280 },
                    focusMode: 'continuous',
                    exposureMode: 'continuous',
                    whiteBalanceMode: 'continuous',
                    frameRate: { ideal: 30, max: 60 }

                },
                audio: false
            })
                .then(function (stream) {
                    video.srcObject = stream;
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                })
                .catch(function (error) {
                    console.error('Oops. Something is broken.', error);
                });

        })

        $('#staticBackdrop').on('hide.bs.modal', function () {
            // close video
            let stream = video.srcObject;
            let tracks = stream.getTracks();

            for (let i = 0; i < tracks.length; i++) {
                let track = tracks[i];
                track.stop();
            }
        })

        $('#add-btn').click(function () {
            if ($('#dept').val() == '' || !$('#dept').val()) {
                return Toast.fire({
                    icon: 'warning',
                    title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å'
                })
            }

            if ($('#team').val() == '' || !$('#team').val()) {
                return Toast.fire({
                    icon: 'warning',
                    title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°'
                })
            }

            let obj = {
                dept: $('#dept').val(),
                team: $('#team').val(),
                arr: JSON.stringify(arr),
                uid: profile.userId,
                displayName: profile.displayName,
                remark: $('#remark').val()
            }
            console.log(obj)
            Swal.fire({
                icon: 'info',
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
                allowOutsideClick: false
            })
            Swal.showLoading(Swal.getConfirmButton())
            $.ajax({
                url: script_url,
                type: 'POST',
                dataType: 'json',
                data: obj,
                success: function (res) {
                    console.log(res)
                    if (res.status == 'success') {
                        let flex = {
                            type: 'flex',
                            altText: 'Flex',
                            contents: {
                                "type": "bubble",
                                "body": {
                                    "type": "box",
                                    "layout": "vertical",
                                    "contents": [
                                        {
                                            "type": "box",
                                            "layout": "vertical",
                                            "contents": [
                                                {
                                                    "type": "text",
                                                    "text": "Brown Cafe",
                                                    "weight": "bold",
                                                    "size": "xl",
                                                    "adjustMode": "shrink-to-fit",
                                                    "color": "#ffffff"
                                                },
                                                {
                                                    "type": "text",
                                                    "text": "hello, world",
                                                    "color": "#ffffff"
                                                }
                                            ],
                                            "backgroundColor": "#57acdc",
                                            "paddingAll": "md"
                                        },
                                        {
                                            "type": "box",
                                            "layout": "vertical",
                                            "contents": [],
                                            "spacing": "md"
                                        }
                                    ],
                                    "spacing": "lg",
                                    "offsetTop": "none",
                                    "paddingAll": "none"
                                },
                                "footer": {
                                    "type": "box",
                                    "layout": "vertical",
                                    "contents": [
                                        {
                                            "type": "text",
                                            "text": "hello, world",
                                            "align": "end",
                                            "size": "xs"
                                        }
                                    ]
                                },
                                "styles": {
                                    "header": {
                                        "separator": false
                                    },
                                    "footer": {
                                        "separator": true
                                    }
                                }
                            }
                        }

                        flex.contents.body.contents[0].contents[0].text = obj.dept
                        if (obj.remark == "") {
                            flex.contents.body.contents[0].contents.pop()
                        } else {
                            flex.contents.body.contents[0].contents[1].text = obj.remark
                        }
                        let count_text = {
                            type: 'text',
                            size: 'xxs',
                            align: "end",
                            text: `‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${new Date().toLocaleDateString('th', { year: 'numeric', month: 'numeric', day: 'numeric' })}  ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ${res.count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`,
                        }
                        flex.contents.footer.contents[0] = count_text
                        arr.forEach((id, i) => {
                            flex.contents.body.contents.push({
                                type: 'text',
                                text: id,
                                align: "center"
                            })
                            if (i == arr.length - 1) {
                                console.log(flex)
                                liff.sendMessages([flex]).catch((err) => {
                                    console.log("error", err);
                                });
                            }
                        })

                        arr = []

                        Swal.fire({
                            icon: 'success',
                            title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                            text: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                            confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                            timer: 3000,
                            allowOutsideClick: false
                        }).then(() => {
                            // location.reload()
                            $('#id-sec').html('')
                            $('#remark').val('')
                            arr = []
                        })
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: '‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                            text: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                            allowOutsideClick: false,
                            showCancelButton: false,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                        })
                    }
                }
            })
        })

        function appendPill(cep) {
            let pill = $(`<span class="badge badged text-bg-success p-2 m-1" style="cursor: pointer">${cep}</span>`)
            $(pill).click(function () {
                let ele = $(this)
                Swal.fire({
                    icon: 'question',
                    title: `‡∏•‡∏ö‡∏£‡∏´‡∏±‡∏™ ${cep}`,
                    showCancelButton: true,
                    confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                    cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
                }).then((result) => {
                    if (result.isConfirmed) {
                        arr = arr.filter(a => a != cep)
                        $(ele).remove()
                        console.log("üöÄ ~ arr", arr)
                    }
                })
            })
            $('#id-sec').append(pill)
            $('#isDemo').change()
            arr.push(cep)
        }
    </script>
    <script>
        var script_url = 'https://script.google.com/macros/s/AKfycbx_g-xZYndPu9IzaYITUdHQ5ckjxX8dGxkB6qkhVfQxMrmAN7PfN9X7ENbVhXCgEWxCEg/exec'
    </script>
    <script>
        function formsubmit() {
            let form = $('#mainform')
            let data = form.serializeArray()
            let obj = {}
            data.forEach(a => obj[a.name] = a.value)
            obj.files = files
            $.ajax({
                url: script_url + '?opt=submit',
                type: 'POST',
                dataType: 'json',
                data: obj,
                success: function (res) {
                    $.LoadingOverlay("hide")
                    console.log(res)
                    if (res.status == 'success') {
                        Swal.fire({
                            icon: 'success',
                            title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                            text: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                            showConfirmButton: false,
                            timer: 1500
                        })
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: '‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                            text: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                            allowOutsideClick: false,
                            showCancelButton: false,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                        })
                    }
                }
            })
        }
    </script>
    <script>

        // Get references to the video and canvas elements
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const snap = document.getElementById('snap');
        var worker
        (async () => {
            worker = await Tesseract.createWorker();
            await worker.loadLanguage('eng');
            await worker.initialize('eng');
            await worker.setParameters({
                tessedit_char_whitelist: '_PYTBDEM0123456789',
                // tessedit_ocr_engine_mode: 'OEM_TESSERACT_LSTM_COMBINED',
            });
            console.log("worker ready")
        })();

        // Get access to the camera



        // Add a listener to the snap button
        snap.addEventListener("click", function () {
            console.log("snap")
            // focus video before take picture
            // get imageData form video
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            // var imageData = canvas.toDataURL('image/png');
            findText()

        });

        function findText() {
            video.pause();
            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏´‡∏±‡∏™',
                allowOutsideClick: false,
            })
            Swal.showLoading(Swal.getConfirmButton());
            worker.recognize(canvas)
                .then(function (result) {
                    let text = result.data.text.replace(/\s/g, '')
                    console.log("üöÄ ~ text", text)
                    // extract only text in format PYT3_00000
                    let regex = /(BMEPYT3_\d{3}|PYT(3|3D)_\d{5})/g;
                    let match = text.match(regex);
                    console.log(match);
                    // pause video
                    // show alert
                    Swal.hideLoading();
                    if (match == null) {
                        Swal.fire({
                            title: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™',
                            text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà',
                            icon: 'error',
                            confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                            allowOutsideClick: false,
                            showConfirmButton: true,
                        }).then((result) => {
                            if (result.isConfirmed) {
                                // resume video
                                video.play();
                            }
                        })
                        return;
                    }
                    Swal.fire({
                        title: match[0],
                        text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™',
                        icon: 'question',
                        confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                        denyButtonText: '‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà',
                        showDenyButton: true,
                        allowOutsideClick: false,
                        showConfirmButton: true,
                    }).then((result) => {
                        if (result.isConfirmed) {
                            if (arr.includes(match[0])) {
                                return Swal.fire({
                                    icon: 'warning',
                                    title: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß',
                                    showConfirmButton: false,
                                    timer: 1000,
                                }).then(() => {
                                    $('#add-id').val('')
                                    video.play()
                                })
                            }
                            appendPill(match[0])
                            Swal.fire({
                                title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                                text: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                                icon: 'success',
                                showConfirmButton: false,
                                timer: 1000,
                                showDenyButton: false,
                            })
                        }
                        video.play();
                    })
                })
                .catch(function (error) {
                    console.error('Oops. Something is broken.', error);
                });
        }

            // setInterval(function () {
            //     snap.click()
            //     }, 100);
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/gasparesganga-jquery-loading-overlay@2.1.7/dist/loadingoverlay.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js" integrity="sha512-pHVGpX7F/27yZ0ISY+VVjyULApbDlD0/X0rgGbTqCE7WFW5MezNTWG/dnhtbBuICzsd0WQPgpE4REBLv+UqChw==" crossorigin="anonymous"
        referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />

    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

</body>

</html>
