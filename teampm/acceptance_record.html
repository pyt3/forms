<!DOCTYPE html>
<html lang="th">

<head>
    <!-- no cache -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <!-- no cache -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
        integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/monthSelect/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/confirmDate/confirmDate.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
        integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://unpkg.com/nprogress@0.2.0/nprogress.css">
    <script src="https://fastly.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://fastly.jsdelivr.net/npm/@pdf-lib/fontkit@1.1.1/dist/fontkit.umd.min.js"></script>

    <style>
        :root {
            --primary-color: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --secondary-color: #10b981;
            --secondary-dark: #059669;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --text-dark: #1f2937;
            --text-light: #6b7280;
            --bg-light: #f9fafb;
            --border-color: #e5e7eb;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans Thai', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 40px 20px;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }


        .form-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 0;
            border-radius: 20px;
            box-shadow: var(--shadow-xl), 0 0 0 1px rgba(255, 255, 255, 0.1);
            /* overflow: hidden; */
            position: relative;
            z-index: 1;
        }

        .form-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            padding: 40px 30px;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .form-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 400px;
            height: 400px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }

        .form-header::after {
            content: '';
            position: absolute;
            bottom: -30%;
            left: -10%;
            width: 300px;
            height: 300px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
        }

        .form-title {
            text-align: center;
            margin: 0;
            font-weight: 700;
            font-size: 28px;
            position: relative;
            z-index: 1;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .form-subtitle {
            text-align: center;
            margin-top: 8px;
            font-size: 14px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .form-body {
            padding: 40px 30px;
        }

        .info-section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            color: var(--primary-color);
        }

        .section-header-wrapper {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            gap: 15px;
            flex-wrap: wrap;
        }

        .section-header-wrapper .section-title {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
            flex: 1;
        }

        .btn-download-pdf {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(239, 68, 68, 0.3);
            white-space: nowrap;
        }

        .btn-download-pdf:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(239, 68, 68, 0.4);
        }

        .btn-download-pdf:active {
            transform: translateY(0);
        }

        .btn-download-pdf i {
            font-size: 16px;
        }

        .info-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            display: block;
            color: var(--text-dark);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .form-group label i {
            font-size: 12px;
            color: var(--primary-color);
        }

        .form-group input {
            width: 100%;
            padding: 12px 16px;
            padding-left: 40px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
            background-color: #fff;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            transform: translateY(-2px);
        }

        .form-group input:hover {
            border-color: var(--primary-light);
        }

        /* Auto-filled input styles */
        .form-group input.auto-filled,
        input.auto-filled {
            background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%);
            border-color: #38bdf8;
            position: relative;
        }

        .form-group input.auto-filled::before {
            content: 'ü§ñ';
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
        }

        /* Radio and checkbox auto-filled */
        input[type="radio"].auto-filled:checked,
        input[type="checkbox"].auto-filled:checked {
            accent-color: #38bdf8;
        }

        /* Remark input auto-filled */
        .remark-input.auto-filled {
            background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%);
            border-color: #38bdf8;
        }

        /* Invalid input styles */
        .form-group input.is-invalid,
        .form-group input:invalid:not(:placeholder-shown) {
            border-color: var(--danger-color);
            background-color: #fef2f2;
        }

        .form-group input.is-invalid:focus,
        .form-group input:invalid:not(:placeholder-shown):focus {
            outline: none;
            border-color: var(--danger-color);
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
        }

        .form-group input.is-invalid+.input-icon {
            color: var(--danger-color);
        }

        .form-group {
            position: relative;
        }

        .form-group .input-icon {
            position: absolute;
            left: 14px;
            top: 41px;
            color: var(--text-light);
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .form-group input:focus+.input-icon {
            color: var(--primary-color);
        }

        /* Search input wrapper with button */
        .input-with-search {
            display: flex;
            gap: 10px;
            align-items: center;
            width: 100%;
        }

        .input-with-search>div {
            position: relative;
            flex: 1;
        }

        .input-with-search input {
            width: 100%;
            padding-right: 16px;
        }

        .input-with-search .input-icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .input-with-search input:focus+.input-icon {
            color: var(--primary-color);
        }

        .btn-search {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(99, 102, 241, 0.3);
            white-space: nowrap;
            flex-shrink: 0;
        }

        .btn-search:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(99, 102, 241, 0.4);
        }

        .btn-search:active {
            transform: translateY(0);
        }

        .btn-search i {
            font-size: 16px;
        }

        .btn-search:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Mobile: Hide input icons for cleaner look */
        @media (max-width: 768px) {
            .form-group input {
                padding-left: 16px;
            }

            .form-group .input-icon {
                display: none;
            }

            .input-with-search {
                flex-direction: column;
                gap: 10px;
                width: 100%;
            }

            .input-with-search>div {
                width: 100%;
            }

            .input-with-search input {
                width: 100%;
                padding-left: 16px;
            }

            .btn-search {
                width: 100%;
                justify-content: center;
            }
        }

        .table-container {
            overflow-x: auto;
            margin-bottom: 30px;
        }

        .checklist-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 0;
            background: white;
        }

        .checklist-table thead {
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .checklist-table th {
            background: var(--primary-color);
            color: white;
            padding: 12px 16px;
            text-align: left;
            font-weight: 500;
            font-size: 13px;
            border-bottom: 2px solid var(--primary-dark);
        }

        .checklist-table th:first-child {
            text-align: center;
            width: 60px;
        }

        .checklist-table th:nth-child(3),
        .checklist-table th:nth-child(4) {
            text-align: center;
            width: 70px;
        }

        .checklist-table th:last-child {
            width: 200px;
        }

        .checklist-table td {
            padding: 12px 16px;
            border-bottom: 1px solid #f3f4f6;
            vertical-align: middle;
            font-size: 14px;
        }

        .checklist-table tbody tr {
            transition: background-color 0.2s ease;
        }

        .checklist-table tbody tr:hover {
            background-color: #f9fafb;
        }

        .checklist-table tbody tr:last-child td {
            border-bottom: none;
        }

        .checklist-table tbody tr.mandatory-row {
            position: relative;
        }

        .checklist-table tbody tr.mandatory-row td:first-child {
            color: var(--danger-color);
            font-weight: 600;
        }

        .checklist-table tbody tr.completed {
            background-color: #f0fdf4;
        }

        .checklist-table td:first-child {
            text-align: center;
            font-weight: 700;
            position: relative;
        }

        .checklist-table td:first-child::before {
            content: attr(data-number);
            display: inline-block;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            color: white;
            min-width: 32px;
            height: 32px;
            line-height: 32px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            padding: 0 8px;
            box-shadow: 0 2px 4px rgba(99, 102, 241, 0.2);
        }

        .checklist-table tbody tr.mandatory-row td:first-child::before {
            background: linear-gradient(135deg, var(--danger-color), #fb923c);
            box-shadow: 0 2px 4px rgba(239, 68, 68, 0.2);
        }

        .checklist-table tbody tr.completed td:first-child::before {
            background: linear-gradient(135deg, var(--secondary-color), var(--secondary-dark));
            box-shadow: 0 2px 4px rgba(16, 185, 129, 0.2);
        }

        .checklist-table td:nth-child(2) {
            color: var(--text-dark);
        }

        .checklist-table td:nth-child(3),
        .checklist-table td:nth-child(4) {
            text-align: center;
        }

        /* Simple Radio Buttons */
        .radio-wrapper {
            display: inline-block;
        }

        .checklist-table input[type="radio"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--secondary-color);
        }

        .checklist-table td:last-child input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 13px;
            transition: all 0.2s ease;
            background: white;
        }

        .checklist-table td:last-child input:focus {
            outline: none;
            border-color: var(--primary-color);
            background: #fafafa;
        }

        .checklist-table td:last-child input::placeholder {
            color: #d1d5db;
        }

        .checklist-table td:last-child input.is-invalid {
            border-color: var(--danger-color);
            background: #fef2f2;
        }

        .checklist-table td:last-child input.is-invalid:focus {
            border-color: var(--danger-color);
            box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.1);
        }

        .mandatory {
            color: var(--danger-color);
            font-weight: 600;
            font-size: 14px;
            margin-right: 4px;
        }

        .signature-section {
            margin-top: 50px;
            padding: 40px;
            background: linear-gradient(135deg, #f9fafb 0%, #e5e7eb 100%);
            border-radius: 12px;
        }

        .signature-section h5 {
            text-align: center;
            margin-bottom: 30px;
            font-weight: 700;
            color: var(--text-dark);
            font-size: 20px;
        }

        .signature-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            margin-top: 30px;
        }

        .signature-box {
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
        }

        .signature-box:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .signature-icon {
            font-size: 32px;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .signature-label {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 14px;
            margin-bottom: 15px;
            display: block;
        }

        .signature-canvas-wrapper {
            position: relative;
            margin: 15px 0;
        }

        .signature-canvas {
            width: 100%;
            height: 150px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: white;
            cursor: crosshair;
            touch-action: none;
        }

        .signature-canvas.signed {
            border-color: var(--secondary-color);
            background: #f0fdf4;
        }

        .signature-controls {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            justify-content: center;
        }

        .signature-btn {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            background: white;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .signature-btn:hover {
            background: var(--bg-light);
            border-color: var(--primary-color);
        }

        .signature-btn.clear {
            color: var(--danger-color);
        }

        .signature-btn.clear:hover {
            background: #fef2f2;
            border-color: var(--danger-color);
        }

        .signature-placeholder {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--text-light);
            font-size: 13px;
            pointer-events: none;
            text-align: center;
        }

        .signature-placeholder i {
            display: block;
            font-size: 24px;
            margin-bottom: 5px;
            opacity: 0.5;
        }

        .btn-submit {
            background: linear-gradient(135deg, var(--secondary-color) 0%, var(--secondary-dark) 100%);
            color: white;
            padding: 16px 48px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-submit:active {
            transform: translateY(0);
        }

        .btn-create-pdf {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            padding: 16px 48px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
        }

        .btn-create-pdf:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-create-pdf:active {
            transform: translateY(0);
        }

        .btn-create-pdf:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .note-section {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-left: 4px solid var(--warning-color);
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
        }

        .note-section::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 200px;
            height: 200px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
        }

        .note-section p {
            margin: 0;
            color: #92400e;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            z-index: 1;
        }

        .note-section i {
            font-size: 20px;
            color: var(--warning-color);
            flex-shrink: 0;
        }

        .stats-bar {
            display: none;
            /* Hidden - replaced with modern progress bar */
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        .stat-number {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-color);
            display: block;
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-light);
            margin-top: 5px;
        }

        .progress-indicator {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
            z-index: 9999;
        }

        /* Modern Progress Bar */
        .modern-progress {
            background: white;
            border-radius: 12px;
            padding: 20px 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
            position: sticky;
            top: 10px;
            z-index: 10;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .progress-title {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .progress-title i {
            color: var(--primary-color);
            font-size: 16px;
        }

        .progress-percentage {
            font-weight: 700;
            font-size: 18px;
            color: var(--primary-color);
        }

        .progress-bar-container {
            position: relative;
            height: 12px;
            background: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.06);
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 10px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 2px 4px rgba(99, 102, 241, 0.3);
        }

        .progress-bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-top: 12px;
            font-size: 12px;
            color: var(--text-light);
        }

        .progress-info-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .progress-info-item i {
            font-size: 14px;
        }

        .progress-info-item.completed {
            color: var(--secondary-color);
        }

        .progress-info-item.mandatory {
            color: var(--danger-color);
        }

        /* Reminder Section */
        .reminder-section {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-left: 4px solid #3b82f6;
            padding: 25px;
            margin-bottom: 30px;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
        }

        .reminder-section:hover {
            box-shadow: var(--shadow-md);
        }

        .reminder-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            position: relative;
            padding: 10px;
            border-radius: 8px;
            transition: background 0.2s ease;
        }

        .reminder-header:hover {
            background: rgba(59, 130, 246, 0.05);
        }

        .reminder-header i {
            font-size: 24px;
            color: #3b82f6;
        }

        .reminder-header h4 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
        }

        /* Toggle Switch Styles */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
            margin: 0;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: 0.3s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch input:checked+.toggle-slider {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }

        .toggle-switch input:checked+.toggle-slider:before {
            transform: translateX(24px);
        }

        .toggle-switch input:focus+.toggle-slider {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        .reminder-content {
            display: grid;
            gap: 20px;
            animation: slideDown 0.3s ease;
        }

        .reminder-input-group {
            display: flex;
            gap: 15px;
            align-items: flex-end;
            flex-wrap: wrap;
        }

        .reminder-input-wrapper {
            flex: 1;
            min-width: 250px;
        }

        .reminder-input-wrapper label {
            display: block;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 8px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .reminder-input-wrapper label i {
            color: #3b82f6;
            font-size: 12px;
        }

        .reminder-input-wrapper input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #bfdbfe;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

        .reminder-input-wrapper input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .reminder-input-wrapper input.is-invalid {
            border-color: var(--danger-color);
            background: #fef2f2;
        }

        .reminder-input-wrapper input.is-invalid:focus {
            border-color: var(--danger-color);
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
        }

        .quick-date-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .quick-date-btn {
            padding: 8px 16px;
            background: white;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            color: #475569;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .quick-date-btn:hover {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .quick-date-btn.clear-btn {
            color: #dc2626;
        }

        .quick-date-btn.clear-btn:hover {
            background: #dc2626;
            border-color: #dc2626;
            color: white;
        }

        .reminder-note {
            padding: 12px 16px;
            background: white;
            border-radius: 8px;
            font-size: 13px;
            color: #1e40af;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .reminder-note i {
            font-size: 16px;
            color: #3b82f6;
            flex-shrink: 0;
        }

        @media (max-width: 768px) {
            body {
                padding: 20px 10px;
            }

            .form-header {
                padding: 30px 20px;
            }

            .form-title {
                font-size: 22px;
            }

            .form-body {
                padding: 30px 20px;
            }

            .info-row {
                grid-template-columns: 1fr;
            }

            .signature-row {
                grid-template-columns: 1fr;
            }

            .checklist-table {
                font-size: 13px;
            }

            /* Mobile-specific table layout */
            .checklist-table thead {
                display: none;
            }

            .checklist-table,
            .checklist-table tbody,
            .checklist-table tr,
            .checklist-table td {
                display: block;
                width: 100%;
            }

            .checklist-table tr {
                margin-bottom: 15px;
                border: 1px solid var(--border-color);
                border-radius: 8px;
                padding: 12px;
                background: white;
            }

            .checklist-table tbody tr:hover {
                background: white;
            }

            .checklist-table td {
                border: none;
                padding: 6px 0;
                text-align: left !important;
            }

            .checklist-table td:first-child {
                padding: 0 0 12px 0;
                text-align: left !important;
                width: 100%;
                display: block;
            }

            .checklist-table td:first-child::before {
                font-size: 12px;
                min-width: 28px;
                height: 28px;
                line-height: 28px;
            }

            .checklist-table td:nth-child(2) {
                padding: 0 0 10px 0;
                font-size: 14px;
                font-weight: 500;
                color: var(--text-dark);
                line-height: 1.5;
            }

            /* Radio buttons container */
            .checklist-table td:nth-child(3),
            .checklist-table td:nth-child(4) {
                width: auto;
                display: inline-block;
                margin-right: 24px;
                padding: 0;
            }

            .checklist-table td:nth-child(3)::before {
                content: '‡∏°‡∏µ ';
                font-weight: 500;
                color: var(--text-dark);
                margin-right: 6px;
                font-size: 13px;
            }

            .checklist-table td:nth-child(4)::before {
                content: '‡πÑ‡∏°‡πà‡∏°‡∏µ ';
                font-weight: 500;
                color: var(--text-dark);
                margin-right: 6px;
                font-size: 13px;
            }

            /* Remark input on new line */
            .checklist-table td:last-child {
                width: 100%;
                margin-top: 12px;
                padding-top: 12px;
                border-top: 1px solid #f3f4f6;
            }

            .checklist-table td:last-child::before {
                content: '‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏';
                display: block;
                font-weight: 500;
                color: var(--text-light);
                margin-bottom: 6px;
                font-size: 12px;
            }

            .checklist-table td:last-child input {
                width: 100%;
                padding: 10px;
                font-size: 13px;
            }

            .btn-submit {
                width: 100%;
                justify-content: center;
            }

            .btn-create-pdf {
                width: 100%;
                justify-content: center;
            }

            .section-title {
                font-size: 16px;
            }

            .section-header-wrapper {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .btn-download-pdf {
                width: 100%;
                justify-content: center;
                padding: 12px 20px;
            }

            .note-section p {
                font-size: 13px;
            }

            .stats-bar {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                padding: 15px;
            }

            .stat-item {
                padding: 12px;
            }

            .stat-number {
                font-size: 24px;
            }

            .stat-label {
                font-size: 11px;
            }

            .signature-row {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .signature-section {
                padding: 20px 15px;
            }

            .signature-box {
                padding: 15px;
            }

            .signature-canvas {
                height: 120px;
            }

            .signature-controls {
                flex-direction: row;
            }

            /* Mobile reminder section */
            .reminder-section {
                padding: 20px 15px;
            }

            .reminder-header h4 {
                font-size: 16px;
            }

            .reminder-input-group {
                flex-direction: column;
                align-items: stretch;
            }

            .reminder-input-wrapper {
                min-width: 100%;
            }

            .quick-date-buttons {
                gap: 6px;
            }

            .quick-date-btn {
                flex: 1;
                min-width: calc(50% - 3px);
                padding: 8px 10px;
                font-size: 12px;
            }

        }

        @media print {
            body {
                background: white;
                padding: 0;
            }

            .form-container {
                box-shadow: none;
            }

            .btn-submit,
            .signature-controls,
            .btn-download-pdf,
            .modern-progress,
            .reminder-section,
            .progress-indicator {
                display: none !important;
            }

            .section-header-wrapper {
                border-bottom: 2px solid var(--primary-color);
                padding-bottom: 10px;
                margin-bottom: 20px;
            }

            .form-header {
                background: var(--primary-color);
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .signature-canvas {
                border: 1px solid #000;
                background: white !important;
            }

            .signature-placeholder {
                display: none !important;
            }

            .stats-bar {
                display: none;
            }

            .note-section {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .checklist-table {
                page-break-inside: auto;
            }

            .checklist-table tr {
                page-break-inside: avoid;
                page-break-after: auto;
            }


        }

        /* Loading Animation */
        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .loading {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        /* Smooth reveal animation */
        .form-container {
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Shake animation for invalid inputs */
        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            10%,
            30%,
            50%,
            70%,
            90% {
                transform: translateX(-5px);
            }

            20%,
            40%,
            60%,
            80% {
                transform: translateX(5px);
            }
        }

        .shake {
            animation: shake infinite ease-in-out;
        }

        /* Error message styling */
        .error-message {
            color: var(--danger-color);
            font-size: 12px;
            margin-top: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
            animation: slideDown 0.3s ease-out;
        }

        .error-message i {
            font-size: 11px;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Tooltip */
        .tooltip-wrapper {
            position: relative;
            display: inline-block;
        }

        .tooltip-text {
            visibility: hidden;
            background-color: var(--text-dark);
            color: white;
            text-align: center;
            padding: 8px 12px;
            border-radius: 6px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            white-space: nowrap;
            box-shadow: var(--shadow-md);
        }

        .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--text-dark) transparent transparent transparent;
        }

        .tooltip-wrapper:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* Button loading state */
        .btn-submit.loading {
            pointer-events: none;
            opacity: 0.7;
        }

        .btn-submit.loading::after {
            content: "";
            position: absolute;
            width: 16px;
            height: 16px;
            top: 50%;
            left: 50%;
            margin-left: -8px;
            margin-top: -8px;
            border: 2px solid transparent;
            border-top-color: white;
            border-radius: 50%;
            animation: button-loading-spinner 0.6s linear infinite;
        }

        @keyframes button-loading-spinner {
            from {
                transform: rotate(0turn);
            }

            to {
                transform: rotate(1turn);
            }
        }
    </style>
</head>

<body>
    <div class="progress-indicator" id="progressBar"></div>

    <div class="form-container">
        <div class="form-header">
            <h1 class="form-title">
                <i class="fas fa-clipboard-check"></i>
                ‡πÅ‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå
            </h1>
            <p class="form-subtitle">Medical Equipment Acceptance Record Form</p>
        </div>

        <div class="form-body">


            <div class="note-section">
                <p>
                    <i class="fas fa-info-circle"></i>
                    <span><strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ <span class="mandatory">*</span>
                        ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô (‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà 1, 2, 3, 4, 5, 7, 8)</span>
                </p>
                <p style="margin-top: 10px;">
                    <i class="fas fa-robot"></i>
                    <span><strong>‡∏ä‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏µ‡∏ü‡πâ‡∏≤</strong> ‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ï‡∏¥‡∏°‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                </p>
            </div>

            <form id="acceptanceForm">
                <!-- Initial Data Section -->
                <div class="info-section">
                    <h3 class="section-title">
                        <i class="fas fa-info-circle"></i>
                        ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
                    </h3>
                    <div class="info-">
                        <div class="form-group">
                            <label for="meCode">
                                <i class="fas fa-tools"></i>
                                ‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠
                            </label>
                            <div class="input-with-search">
                                <div style="position: relative; flex: 1;">
                                    <input type="text" id="meCode" name="meCode"
                                        placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ PYT3_xxxxx" required>
                                    <i class="fas fa-tools input-icon"></i>
                                </div>
                                <button type="button" class="btn-search" onclick="searchPreviousData()">
                                    <i class="fas fa-search"></i>
                                    ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="info-row">
                        <div class="form-group">
                            <label for="manufacturer">
                                <i class="fas fa-industry"></i>
                                ‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï
                            </label>
                            <input type="text" id="manufacturer" name="manufacturer" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï">
                            <i class="fas fa-industry input-icon"></i>
                        </div>
                        <div class="form-group">
                            <label for="vendor">
                                <i class="fas fa-store"></i>
                                ‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢
                            </label>
                            <input type="text" id="vendor" name="vendor" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢">
                            <i class="fas fa-store input-icon"></i>
                        </div>
                    </div>

                    <div class="info-row">
                        <div class="form-group">
                            <label for="date">
                                <i class="fas fa-calendar-alt"></i>
                                ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
                            </label>
                            <input type="date" id="date" name="date">
                            <i class="fas fa-calendar-alt input-icon"></i>
                        </div>
                        <div class="form-group">
                            <label for="equipment">
                                <i class="fas fa-heartbeat"></i>
                                ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
                            </label>
                            <input type="text" id="equipment" name="equipment" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á">
                            <i class="fas fa-heartbeat input-icon"></i>
                        </div>
                    </div>

                    <div class="info-row">
                        <div class="form-group">
                            <label for="model">
                                <i class="fas fa-tag"></i>
                                ‡∏£‡∏∏‡πà‡∏ô
                            </label>
                            <input type="text" id="model" name="model" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏∏‡πà‡∏ô">
                            <i class="fas fa-tag input-icon"></i>
                        </div>
                        <div class="form-group">
                            <label for="serialNumber">
                                <i class="fas fa-barcode"></i>
                                S/N
                            </label>
                            <input type="text" id="serialNumber" name="serialNumber" placeholder="S/N">
                            <i class="fas fa-barcode input-icon"></i>
                        </div>
                    </div>

                    <div class="info-row">
                        <div class="form-group">
                            <label for="quotationNo">
                                <i class="fas fa-file-invoice"></i>
                                ‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤ ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà
                            </label>
                            <input type="text" id="quotationNo" name="quotationNo" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤">
                            <i class="fas fa-file-invoice input-icon"></i>
                        </div>
                        <div class="form-group">
                            <label for="invoiceNo">
                                <i class="fas fa-receipt"></i>
                                Invoice ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà
                            </label>
                            <input type="text" id="invoiceNo" name="invoiceNo" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà Invoice">
                            <i class="fas fa-receipt input-icon"></i>
                        </div>
                    </div>
                    <div class="info-row">
                        <div class="form-group">
                            <label for="recorder">
                                <i class="fas fa-user-edit"></i>
                                ‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                            </label>
                            <input type="text" id="recorder" name="recorder" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å"
                                list="recorderList" autocomplete="on" required>
                            <i class="fas fa-user-edit input-icon"></i>
                            <datalist id="recorderList">
                                <option value="" selected disabled>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠</option>
                                <option value="CHAIWAT SALAIWONG">CHAIWAT SALAIWONG</option>
                                <option value="PASSAWAN TOANUN">PASSAWAN TOANUN</option>
                                <option value="PANALEE UEASUNTHONNOP">PANALEE UEASUNTHONNOP</option>
                                <option value="SERMKEAT HADJANG">SERMKEAT HADJANG</option>
                                <option value="CHANCHAI SAE-LEE">CHANCHAI SAE-LEE</option>
                                <option value="SARAN THAMMATHORN">SARAN THAMMATHORN</option>
                                <option value="PUKARIN TONGKLIANG">PUKARIN TONGKLIANG</option>
                                <option value="ANUPHAB CHANTO">ANUPHAB CHANTO</option>
                                <option value="NARUECHA CHAIYAPHAN">NARUECHA CHAIYAPHAN</option>
                                <option value="ITTIPAT IEMDEE">ITTIPAT IEMDEE</option>
                                <option value="SASIMAPORN KHANTHAHOME">SASIMAPORN KHANTHAHOME</option>
                                <option value="DARANPHOP YIMYAM">DARANPHOP YIMYAM</option>
                                <option value="CHATVIPA KAEWPRESERT">CHATVIPA KAEWPRESERT</option>
                                <option value="RAPIPHAN KHAMSUWAN">RAPIPHAN KHAMSUWAN</option>
                                <option value="SOM KONKAEW">SOM KONKAEW</option>
                                <option value="PATCHARAPORN JORNSAMER">PATCHARAPORN JORNSAMER</option>
                                <option value="RATCHATA PIRIYAKITTSAKUL">RATCHATA PIRIYAKITTSAKUL</option>
                                <option value="ILADA BUAPRALAT">ILADA BUAPRALAT</option>
                                <option value="JIRASSAYA CHUENYOO">JIRASSAYA CHUENYOO</option>
                                <option value="CHALERMPORN SABUA">CHALERMPORN SABUA</option>
                            </datalist>
                        </div>
                    </div>
                </div>

                <!-- Checklist Table -->
                <div class="info-section">
                    <div class="section-header-wrapper">
                        <h3 class="section-title">
                            <i class="fas fa-tasks"></i>
                            ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
                        </h3>
                        <button type="button" class="btn-download-pdf" onclick="downloadChecklistPDF()">
                            <i class="fas fa-file-pdf"></i>
                            ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF
                        </button>
                    </div>
                    <!-- Modern Progress Bar -->
                    <div class="modern-progress">
                        <div class="progress-header">
                            <div class="progress-title">
                                <i class="fas fa-tasks"></i>
                                ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
                            </div>
                            <div class="progress-percentage" id="completionPercent">0%</div>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar-fill" id="progressBarFill" style="width: 0%"></div>
                        </div>
                        <div class="progress-info">
                            <div class="progress-info-item completed">
                                <i class="fas fa-check-circle"></i>
                                <span><span id="completedItems">0</span> / <span id="totalItems">22</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                            </div>
                            <div class="progress-info-item mandatory">
                                <i class="fas fa-exclamation-circle"></i>
                                <span>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö: <span id="mandatoryItems">7</span></span>
                            </div>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="checklist-table">
                            <thead>
                                <tr>
                                    <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                                    <th>‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</th>
                                    <th>‡∏°‡∏µ</th>
                                    <th>‡πÑ‡∏°‡πà‡∏°‡∏µ</th>
                                    <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                                </tr>
                            </thead>
                            <tbody id="checklistBody">
                                <!-- Rows will be generated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Reminder Section -->
                <div class="reminder-section">
                    <div class="reminder-header">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-bell"></i>
                            <h4>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h4>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="reminderToggle" onchange="toggleReminderContent()"
                                name="reminderToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="reminder-content mt-3" id="reminderContent" style="display: none;">
                        <div class="reminder-input-group">
                            <div class="reminder-input-wrapper">
                                <label for="reminderDate">
                                    <i class="fas fa-calendar-check"></i>
                                    ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                                </label>
                                <input type="date" id="reminderDate" name="reminderDate" placeholder="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà">
                            </div>
                            <div class="reminder-input-wrapper">
                                <label for="reminderNote">
                                    <i class="fas fa-sticky-note"></i>
                                    ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                                </label>
                                <input type="text" id="reminderNote" name="reminderNote"
                                    placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£, ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á">
                            </div>
                        </div>
                        <div>
                            <label
                                style="display: block; font-weight: 600; margin-bottom: 10px; color: var(--text-dark); font-size: 13px;">
                                ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡πà‡∏ß‡∏ô:
                            </label>
                            <div class="quick-date-buttons">
                                <button type="button" class="quick-date-btn" onclick="setQuickDate(3)">3 ‡∏ß‡∏±‡∏ô</button>
                                <button type="button" class="quick-date-btn" onclick="setQuickDate(7)">1
                                    ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</button>
                                <button type="button" class="quick-date-btn" onclick="setQuickDate(14)">2
                                    ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</button>
                                <button type="button" class="quick-date-btn" onclick="setQuickDate(30)">1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
                                <button type="button" class="quick-date-btn clear-btn"
                                    onclick="clearReminder()">‡∏•‡πâ‡∏≤‡∏á</button>
                            </div>
                        </div>
                        <div class="reminder-note mt-3">
                            <i class="fas fa-info-circle"></i>
                            <span>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</span>
                        </div>
                    </div>
                </div>


                <div
                    style="display: flex; gap: 15px; justify-content: center; align-items: center; flex-wrap: wrap; margin-top: 40px;">
                    <button type="button" class="btn-submit" id="acceptanceFormSubmitButton">
                        <i class="fas fa-save"></i>
                        ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    </button>
                    <button type="button" class="btn-create-pdf" onclick="createPDFFile()" style="display: none;">
                        <i class="fas fa-file-pdf"></i>
                        ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå PDF
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="form-container mt-3 d-none" id="downloadFileContainer">
        <div class="form-body">
            <h3 class="section-title">
                <i class="fas fa-download"></i>
                ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
            </h3>
            <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; padding: 20px;">
                <button type="button" class="btn-download-pdf"
                    style="background: linear-gradient(135deg, #6366f1 0%, #818cf8 100%); padding: 16px 32px; font-size: 18px;">
                    <i class="fas fa-file-download"></i>
                    ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå
                </button>
            </div>
            <iframe id="pdf"
                style="width: 100%; height: calc(100vw *(1.4142)); display: none;  border-radius: 20px;"></iframe>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/locale/th.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/l10n/th.js"></script>
    <script src="https://unpkg.com/nprogress@0.2.0/nprogress.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>


    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx9gJp3t1vHLSpGZF7rGDPq9M8xY6eThFJsOvRBStYAVIW4tA3VzgU80awM_22C5P0/exec'

        // Search for previous data by meCode
        async function searchPreviousData(isAutoSearch = false) {
            const meCode = document.getElementById('meCode').value.trim();
            console.log('Searching for ME Code:', meCode);
            if (!meCode) {
                Swal.fire({
                    icon: 'warning',
                    title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠',
                    text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤',
                    confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                    confirmButtonColor: '#f59e0b',
                    customClass: { popup: 'rounded-3' }
                });
                return;
            }

            // Show loading
            if (!isAutoSearch) {
                Swal.fire({
                    title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...',
                    html: `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á <strong>${meCode}</strong>`,
                    allowOutsideClick: false,
                    customClass: { popup: 'rounded-3' },
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });
            } else {
                NProgress.start();
                NProgress.inc()
                Swal.fire({
                    title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...',
                    html: `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á <strong>${meCode}</strong>`,
                    allowOutsideClick: false,
                    customClass: { popup: 'rounded-3' },
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });
            }

            try {
                $.get(SCRIPT_URL, { action: 'searchByMeCode', meCode: meCode }, function (response) {
                    handleSearchResponse(response, meCode, isAutoSearch);
                });
            } catch (error) {
                console.error('Error initiating search:', error);
                Swal.close();
            }
        }

        // Handle search response
        function handleSearchResponse(response, meCode, isAutoSearch) {
            NProgress.done();
            console.log('Search response:', response);
            Swal.close();
            if (response.success && response.data) {
                if (!isAutoSearch) {

                    Swal.fire({
                        icon: 'success',
                        title: '‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                        html: `
                        <div style="text-align: left; padding: 15px; background: #f9fafb; border-radius: 8px; margin-top: 10px;">
                            <div style="margin-bottom: 10px;"><strong>‡∏£‡∏´‡∏±‡∏™:</strong> ${meCode}</div>
                            <div style="margin-bottom: 10px;"><strong>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á:</strong> ${response.data.equipment || '-'}</div>
                            <div style="margin-bottom: 10px;"><strong>‡∏£‡∏∏‡πà‡∏ô:</strong> ${response.data.model || '-'}</div>
                            <div style="margin-bottom: 10px;"><strong>‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢:</strong> ${response.data.vendor || '-'}</div>
                            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e5e7eb;">
                                ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?
                            </div>
                        </div>
                    `,
                        confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                        confirmButtonColor: '#10b981',
                        customClass: { popup: 'rounded-3' }
                    }).then((result) => {
                        if (result.isConfirmed) {
                            // Scroll to form
                            fillFormWithData(response.data);
                            // Show PDF button
                            showPDFButton();
                        }
                    });
                } else {
                    fillFormWithData(response.data);
                    // Show PDF button
                    showPDFButton();
                }
            } else {
                Swal.fire({
                    icon: 'info',
                    title: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                    html: `‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á <strong>${meCode}</strong> ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö`,
                    confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                    confirmButtonColor: '#3b82f6',
                    customClass: { popup: 'rounded-3' }
                });
            }
        }

        // Fill form with retrieved data
        function fillFormWithData(data) {
            console.log('Filling form with data:', data);
            // Store UUID for updates
            if (data.uuid) {
                localStorage.setItem('formUUID', data.uuid);
            }

            // clear existing values and auto-filled class
            $('input').each(function () {
                $(this).removeClass('auto-filled');
                if (this.type == 'radio') {
                    this.checked = false;
                }
                else if (this.type == 'checkbox') {
                    this.checked = false;
                }
                else {
                    this.value = '';
                }
            });

            if (data.date) {
                const dateInput = document.getElementById('date');
                dateInput.value = data.date;
                if (dateInput._flatpickr) {
                    dateInput._flatpickr.setDate(data.date)
                    $(dateInput).trigger('input').addClass('auto-filled');
                }
            }
            if (data.me_code) $('#meCode').val(data.me_code).trigger('input').addClass('auto-filled');
            if (data.manufacturer) $('#manufacturer').val(data.manufacturer).trigger('input').addClass('auto-filled');
            if (data.vendor) $('#vendor').val(data.vendor).trigger('input').addClass('auto-filled');
            if (data.date) $('#date').val(data.date).trigger('input').addClass('auto-filled');
            if (data.equipment) $('#equipment').val(data.equipment).trigger('input').addClass('auto-filled');
            if (data.model) $('#model').val(data.model).trigger('input').addClass('auto-filled');
            if (data.serial_number) $('#serialNumber').val(data.serial_number).trigger('input').addClass('auto-filled');
            if (data.quotation_no) $('#quotationNo').val(data.quotation_no).trigger('input').addClass('auto-filled');
            if (data.invoice_no) $('#invoiceNo').val(data.invoice_no).trigger('input').addClass('auto-filled');
            if (data.recorder) $('#recorder').val(data.recorder).trigger('input').addClass('auto-filled');

            data.checklist_data = JSON.parse(data.checklist_data || '[]');
            console.log(data.checklist_data);
            // Fill checklist if available
            if (data.checklist_data && Array.isArray(data.checklist_data)) {
                data.checklist_data.forEach(item => {
                    const presentRadio = document.getElementById(`present_${item.no}`);
                    const absentRadio = document.getElementById(`absent_${item.no}`);
                    const remarkInput = document.getElementById(`remark_${item.no}`);

                    if (item.status === '‡∏°‡∏µ' && presentRadio) {
                        presentRadio.checked = true;
                        $(presentRadio).trigger('input').addClass('auto-filled');
                    } else if (item.status === '‡πÑ‡∏°‡πà‡∏°‡∏µ' && absentRadio) {
                        absentRadio.checked = true;
                        $(absentRadio).trigger('input').addClass('auto-filled');
                    }

                    // Fill remark if available
                    if (item.remark && remarkInput) {
                        remarkInput.value = item.remark;
                        $(remarkInput).trigger('input').addClass('auto-filled');
                    }
                });

                // Update stats after filling checklist
                updateStats();
            }

            // Fill reminder if available
            if (data.reminder) {
                if (data.reminder.date) {
                    $('#reminderToggle').prop('checked', true).addClass('auto-filled');
                    const reminderDateInput = document.getElementById('reminderDate');
                    if (reminderDateInput._flatpickr) {
                        reminderDateInput._flatpickr.setDate(data.reminder.date);
                    }
                    $('#reminderDate').trigger('input').addClass('auto-filled');
                }
                if (data.reminder.note) {
                    $('#reminderNote').val(data.reminder.note).trigger('input').addClass('auto-filled');
                }
            }

            // Visual feedback
            const inputs = document.querySelectorAll('input[type="text"], input[type="date"]');
            inputs.forEach(input => {
                if (input.value) {
                    input.style.animation = 'pulse 0.5s ease';
                    setTimeout(() => {
                        input.style.animation = '';
                    }, 500);
                }
            });
        }

        // Checklist items data
        const checklistItems = [
            { no: 1, document: "BME Report (FP-BME-NHS-00-026/2)", mandatory: true },
            { no: 2, document: "Medical Equipment Assessment Form (FP-BME-NHS-00-033/3)", mandatory: true },
            { no: 3, document: "Acceptance Test Reports (FP-BME-NHS-00-026/3)", mandatory: true },
            { no: 4, document: "Certificate & License for Device (‡πÉ‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)", mandatory: true },
            { no: 5, document: "‡∏™‡∏≥‡πÄ‡∏ô‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÅ‡∏û‡∏ó‡∏¢‡πå ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô (FDA, ‡∏≠‡∏¢., ‡∏°‡∏≠‡∏Å.)", mandatory: true },
            {
                no: 6, document: "‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤ ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà (‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤)", mandatory: true, addi_input: {
                    type: 'text',
                    placeholder: '‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤',
                    label: '‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤'
                }
            },
            { no: 7, document: "Spec ‡∏£‡∏∏‡πà‡∏ô ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏ï‡∏≤‡∏°‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤", mandatory: true },
            {
                no: 8, document: "Invoice ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà (‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏ô‡∏µ‡πâ)", mandatory: true, addi_input: {
                    type: 'text',
                    placeholder: '‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà Invoice',
                    label: '‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà Invoice'
                }
            },
            { no: 9, document: "‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏ó‡∏ô‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢", mandatory: false },
            { no: 10, document: "Certificate Engineer (‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£)", mandatory: false },
            { no: 11, document: "Tester's Certificates (‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö)", mandatory: false },
            { no: 12, document: "Schedule of maintenance with detail (‡πÅ‡∏ú‡∏ô‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÅ‡∏•‡∏∞‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î)", mandatory: false },
            { no: 13, document: "Service Manuals (‡∏â‡∏ö‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ ‡πÅ‡∏•‡∏∞‡∏â‡∏ö‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©)", mandatory: false },
            { no: 14, document: "Operating Manuals (‡∏â‡∏ö‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ ‡πÅ‡∏•‡∏∞‡∏â‡∏ö‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©)", mandatory: false },
            { no: 15, document: "Purchasing contract (‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢) (‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤ 1 ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó)", mandatory: false },
            { no: 16, document: "Service contract (‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢)", mandatory: false },
            { no: 17, document: "‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏£‡∏°‡∏ß‡∏¥‡∏ó‡∏¢‡πå (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏£‡∏±‡∏á‡∏™‡∏µ)", mandatory: false },
            { no: 18, document: "Air waybill/Bill of Loading (‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤)", mandatory: false },
            { no: 19, document: "‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ Training User (‡πÅ‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏° ‡∏ù‡πà‡∏≤‡∏¢‡πÅ‡∏û‡∏ó‡∏¢‡πå FP-BME-NHS-00-026/5 ‡πÅ‡∏•‡∏∞‡∏ù‡πà‡∏≤‡∏¢‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• FP-BME-NHS-00-026/6)", mandatory: false },
            { no: 20, document: "Network Document (‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ Network)", mandatory: false },
            { no: 21, document: "Value Analysis (‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)", mandatory: false },
            { no: 22, document: "‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (FP-BME-NHS-00-026/4)", mandatory: false }
        ];

        // Quick date selection functions
        function setQuickDate(days) {
            const today = new Date();
            today.setDate(today.getDate() + days);
            const dateString = today.toISOString().split('T')[0];
            document.getElementById('reminderDate').value = dateString;

            // Trigger flatpickr update if initialized
            const reminderDateInput = document.getElementById('reminderDate');
            if (reminderDateInput._flatpickr) {
                reminderDateInput._flatpickr.setDate(dateString);
            }

            // Visual feedback
            const reminderSection = document.querySelector('.reminder-section');
            reminderSection.style.animation = 'pulse 0.5s ease';
            setTimeout(() => {
                reminderSection.style.animation = '';
            }, 500);
        }

        // Clear reminder inputs
        function clearReminder() {
            document.getElementById('reminderDate').value = '';
            document.getElementById('reminderNote').value = '';

            // Clear flatpickr if initialized
            const reminderDateInput = document.getElementById('reminderDate');
            if (reminderDateInput._flatpickr) {
                reminderDateInput._flatpickr.clear();
            }

            Swal.fire({
                toast: true,
                position: 'top-end',
                icon: 'info',
                title: '‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß',
                showConfirmButton: false,
                timer: 1500,
                customClass: { popup: 'rounded-3' }
            });
        }

        // Toggle reminder content visibility
        function toggleReminderContent() {
            const reminderContent = document.getElementById('reminderContent');
            const toggleSwitch = document.getElementById('reminderToggle');

            if (toggleSwitch.checked) {
                reminderContent.style.display = 'block';
            } else {
                reminderContent.style.display = 'none';
            }
        }

        // Format date to Thai locale
        function formatThaiDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('th-TH', options);
        }

        // Download Checklist as PDF
        function downloadChecklistPDF() {
            NProgress.start();

            let pdf_path = './invent_form.pdf';
            // init downlad
            let a = document.createElement('a');
            a.href = pdf_path;
            a.download = pdf_path.split('/').pop();
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // Generate checklist table rows
        function generateChecklistTable() {
            const tbody = document.getElementById('checklistBody');
            tbody.innerHTML = '';

            checklistItems.forEach((item, index) => {
                const row = document.createElement('tr');
                const mandatoryMark = item.mandatory ? '<span class="mandatory">*</span> ' : '';

                if (item.mandatory) {
                    row.classList.add('mandatory-row');
                }

                row.innerHTML = `
                    <td data-number="${item.no}" class="text-center"></td>
                    <td>
                        ${mandatoryMark}${item.document}
                    </td>
                    <td>
                        <div class="radio-wrapper">
                            <input type="radio" name="item_${item.no}" value="present" 
                                   id="present_${item.no}" class="form-check-input" onchange="updateStats()">
                        </div>
                    </td>
                    <td>
                        <div class="radio-wrapper">
                            <input type="radio" name="item_${item.no}" value="absent" 
                                   id="absent_${item.no}" class="form-check-input" onchange="updateStats()">
                        </div>
                    </td>
                    <td>
                        <input type="text" name="remark_${item.no}" 
                               id="remark_${item.no}" class="remark-input" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏...">
                    </td>
                `;
                tbody.appendChild(row);
            });

            // Add event listeners to all inputs in the checklist table
            const checklistInputs = tbody.querySelectorAll('input');
            checklistInputs.forEach(input => {
                input.addEventListener('input', function () {
                    this.classList.remove('is-invalid', 'shake');
                });
            });
        }

        // Validate mandatory items
        function validateMandatoryItems() {
            const errors = [];

            checklistItems.forEach(item => {
                if (item.mandatory) {
                    const presentRadio = document.getElementById(`present_${item.no}`);
                    const absentRadio = document.getElementById(`absent_${item.no}`);

                    if (!presentRadio.checked && !absentRadio.checked) {
                        errors.push(`‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà ${item.no}: ${item.document} - ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞`);
                    } else if (absentRadio.checked) {
                        errors.push(`‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà ${item.no}: ${item.document} - ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ`);
                    }
                }
            });

            return errors;
        }

        // Update statistics and progress bar
        function updateStats() {
            let completedCount = 0;

            checklistItems.forEach(item => {
                const presentRadio = document.getElementById(`present_${item.no}`);
                const absentRadio = document.getElementById(`absent_${item.no}`);
                const row = presentRadio?.closest('tr');

                if (presentRadio?.checked || absentRadio?.checked) {
                    completedCount++;
                    row?.classList.add('completed');

                    // Add visual feedback for completed row
                    if (presentRadio?.checked) {
                        row?.classList.remove('completed');
                        row?.classList.add('completed');
                    }
                } else {
                    row?.classList.remove('completed');
                }
            });

            const totalCount = checklistItems.length;
            const percentage = Math.round((completedCount / totalCount) * 100);

            // Update stats display
            document.getElementById('completedItems').textContent = completedCount;
            document.getElementById('completionPercent').textContent = percentage + '%';

            // Update modern progress bar
            const progressBarFill = document.getElementById('progressBarFill');
            if (progressBarFill) {
                progressBarFill.style.width = percentage + '%';

                // Change progress bar color based on completion
                if (percentage === 100) {
                    progressBarFill.style.background = 'linear-gradient(90deg, #10b981, #059669)';
                    progressBarFill.style.boxShadow = '0 2px 4px rgba(16, 185, 129, 0.3)';
                } else if (percentage >= 50) {
                    progressBarFill.style.background = 'linear-gradient(90deg, #f59e0b, #d97706)';
                    progressBarFill.style.boxShadow = '0 2px 4px rgba(245, 158, 11, 0.3)';
                } else {
                    progressBarFill.style.background = 'linear-gradient(90deg, #6366f1, #818cf8)';
                    progressBarFill.style.boxShadow = '0 2px 4px rgba(99, 102, 241, 0.3)';
                }
            }

            // Update top progress indicator
            document.getElementById('progressBar').style.transform = `scaleX(${percentage / 100})`;
            const progressBar = document.getElementById('progressBar');
            if (percentage === 100) {
                progressBar.style.background = 'linear-gradient(90deg, #10b981, #059669)';
            } else if (percentage >= 50) {
                progressBar.style.background = 'linear-gradient(90deg, #f59e0b, #d97706)';
            } else {
                progressBar.style.background = 'linear-gradient(90deg, #6366f1, #10b981)';
            }
        }

        // Form submission handler
        document.getElementById('acceptanceFormSubmitButton').addEventListener('click', function (e) {

            const form = document.getElementById('acceptanceForm');

            if (form.checkValidity()) {
                event.stopPropagation();
                console.log('Form is valid, submitting...');
                e.preventDefault(); // Prevent default form submission
                submitForm();
            } else {
                // Add was-validated class to form
                form.classList.add('was-validated');

                // Find all invalid inputs
                const invalidInputs = form.querySelectorAll('input:invalid');
                let firstInvalid = null;

                console.log('Found', invalidInputs.length, 'invalid inputs');

                invalidInputs.forEach((input, index) => {
                    console.log('Invalid input:', input.id || input.name, input);

                    // Add is-invalid and shake classes
                    input.classList.add('is-invalid');
                    input.classList.add('shake');

                    // Track first invalid input
                    if (index === 0) {
                        firstInvalid = input;
                    }
                });

                // Scroll to first invalid input
                if (firstInvalid) {
                    firstInvalid.scrollIntoView({
                        behavior: 'smooth',
                        block: 'center'
                    });

                    // Focus on first invalid input after scroll
                    setTimeout(() => {
                        firstInvalid.focus();
                    }, 500);
                }


                // Remove shake class after animation
                setTimeout(() => {
                    invalidInputs.forEach(input => {
                        input.classList.remove('shake');
                    });
                }, 5000);
            }
        });

        function submitForm() {
            let meCode = $('#meCode').val().trim();
            // allow only me code that start with "PYT3" or "DEMO"
            if (!meCode.startsWith("PYT3") && !meCode.startsWith("DEMO")) {
                Swal.fire({
                    icon: 'error',
                    title: '‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
                    text: '‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ "PYT3" ‡∏´‡∏£‡∏∑‡∏≠ "DEMO".',
                    confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                }).then(() => {
                    document.getElementById('meCode').focus();
                });
                return;
            }

            const submitBtn = document.querySelector('.btn-submit');
            submitBtn.classList.add('loading');
            submitBtn.disabled = true;

            NProgress.start();

            // Validate mandatory items
            const errors = validateMandatoryItems();

            // if (errors.length > 0) {
            //     NProgress.done();
            //     submitBtn.classList.remove('loading');
            //     submitBtn.disabled = false;

            //     Swal.fire({
            //         icon: 'error',
            //         title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô',
            //         html: '<div style="text-align: left; max-height: 300px; overflow-y: auto;">' +
            //             errors.map(err => `<div style="margin: 8px 0; padding: 8px; background: #fef2f2; border-radius: 6px;"><i class="fas fa-exclamation-circle" style="color: #ef4444;"></i> ${err}</div>`).join('') +
            //             '</div>',
            //         confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
            //         confirmButtonColor: '#ef4444',
            //         width: '600px'
            //     });

            //     // Scroll to first error
            //     const firstError = errors[0];
            //     const errorNo = firstError.match(/‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà (\d+)/)?.[1];
            //     if (errorNo) {
            //         const errorRow = document.getElementById(`present_${errorNo}`)?.closest('tr');
            //         errorRow?.scrollIntoView({ behavior: 'smooth', block: 'center' });
            //         errorRow.style.animation = 'shake 0.5s';
            //     }
            //     return;
            // }

            // Generate or retrieve UUID for this form session
            let formUUID = localStorage.getItem('formUUID');

            // Collect form data
            const formData = {
                manufacturer: document.getElementById('manufacturer').value,
                vendor: document.getElementById('vendor').value,
                date: document.getElementById('date').value,
                equipment: document.getElementById('equipment').value,
                model: document.getElementById('model').value,
                serialNumber: document.getElementById('serialNumber').value,
                quotationNo: document.getElementById('quotationNo').value,
                invoiceNo: document.getElementById('invoiceNo').value,
                reminder: {
                    date: document.getElementById('reminderDate').value,
                    note: document.getElementById('reminderNote').value
                },
                checklist: [],
                recorder: document.getElementById('recorder').value,
                uuid: formUUID
            };


            // Collect checklist data
            checklistItems.forEach(item => {
                const presentRadio = document.getElementById(`present_${item.no}`);
                const absentRadio = document.getElementById(`absent_${item.no}`);
                const remark = document.getElementById(`remark_${item.no}`).value;

                const checklistEntry = {
                    no: item.no,
                    document: item.document,
                    status: presentRadio.checked ? '‡∏°‡∏µ' : (absentRadio.checked ? '‡πÑ‡∏°‡πà‡∏°‡∏µ' : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'),
                    remark: remark
                };

                formData.checklist.push(checklistEntry);
            });
            formData.checklist = JSON.stringify(formData.checklist);
            formData.reminder = JSON.stringify(formData.reminder);
            formData.meCode = document.getElementById('meCode').value.trim();
            formData.action = 'submit_form';
            NProgress.start();
            console.log('Submitting form data:', formData);
            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...',
                html: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
                allowOutsideClick: false,
                customClass: { popup: 'rounded-3' },
                didOpen: () => {
                    Swal.showLoading();
                }
            })

            // Submit data to Google Apps Script
            $.post(SCRIPT_URL, formData, function (data) {
                console.log(data)
                NProgress.done();
                submitBtn.classList.remove('loading');
                submitBtn.disabled = false;

                if (data.status === 'success') {
                    const actionText = data.action === 'updated' ? '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' : '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
                    const messageText = data.action === 'updated'
                        ? '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß'
                        : '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß';

                    Swal.fire({
                        icon: 'success',
                        title: actionText,
                        text: messageText,
                        confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                        confirmButtonColor: '#10b981',
                        customClass: { popup: 'rounded-3' }
                    }).then(() => {
                        // Show PDF button after successful submission
                        showPDFButton();
                        $('input').each(function () {
                            localStorage.removeItem('acceptance_record_' + this.name);
                        });
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                        text: data.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
                        confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                        confirmButtonColor: '#ef4444',
                        customClass: { popup: 'rounded-3' }
                    });
                }
            }).fail(function () {
                NProgress.done();
                submitBtn.classList.remove('loading');
                submitBtn.disabled = false;

                Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
                    confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                    confirmButtonColor: '#ef4444',
                    customClass: { popup: 'rounded-3' }
                });
            });
        }

        // Generate table on page load
        document.addEventListener('DOMContentLoaded', function () {
            generateChecklistTable();

            localStorage.removeItem('formUUID'); // Clear previous UUID on new load
            flatpickr("#date", {
                locale: "th",
                dateFormat: "Y-m-d",
                altFormat: "d F Y",
                altInput: true,
                allowInput: true,
                defaultDate: "today"
            });

            // Initialize flatpickr for reminder date
            flatpickr("#reminderDate", {
                locale: "th",
                dateFormat: "Y-m-d",
                altFormat: "d F Y",
                altInput: true,
                allowInput: true,
                minDate: "today",
                onChange: function (selectedDates, dateStr, instance) {
                    if (dateStr) {
                        // Visual feedback when date is selected
                        const reminderSection = document.querySelector('.reminder-section');
                        reminderSection.style.borderLeftColor = '#3b82f6';
                        reminderSection.style.borderLeftWidth = '5px';

                        setTimeout(() => {
                            reminderSection.style.borderLeftWidth = '4px';
                        }, 300);
                    }
                }
            });

            // Add Enter key listener for meCode search
            const meCodeInput = document.getElementById('meCode');
            if (meCodeInput) {
                meCodeInput.addEventListener('keypress', function (e) {
                    if (e.key === 'Enter' || e.keyCode === 13) {
                        e.preventDefault();
                        searchPreviousData();
                    }
                });
                $(meCodeInput).on('input', function () {
                    this.value = this.value.toUpperCase();
                });
            }

            handleRemainData()
            $('input').each(function () {
                // Add focus and blur animations
                $(this).on('focus', function () {
                    $(this).parent().addClass('focused');
                });
                $(this).on('blur', function () {
                    $(this).parent().removeClass('focused');
                });

                // Remove invalid class and auto-filled class on manual input
                $(this).on('input', function () {
                    $(this).removeClass('is-invalid shake');
                    // Remove auto-filled class when user manually edits
                    if ($(this).hasClass('auto-filled')) {
                        $(this).removeClass('auto-filled');
                    }
                    // Remove error message if exists
                    $(this).siblings('.error-message').remove();
                });

                // Auto-save to localStorage with debounce
                $(this).on('input', _.debounce(function () {
                    if (this.name === 'reminderToggle' && this.checked === false) {
                        // If reminder is toggled off, clear reminder data
                        document.getElementById('reminderDate').value = '';
                        document.getElementById('reminderNote').value = '';
                        localStorage.removeItem('acceptance_record_reminderDate');
                        localStorage.removeItem('acceptance_record_reminderNote');
                        return;

                    }
                    if (this.name === 'meCode') return // do not save meCode to localStorage
                    localStorage.setItem('acceptance_record_' + this.name, this.type === 'checkbox' ? this.checked : this.value);
                }, 500));
            });

            // Initialize stats
            updateStats();

            // Add keyboard shortcuts
            document.addEventListener('keydown', function (e) {
                // Ctrl/Cmd + S to save (prevent default browser save)
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    document.getElementById('acceptanceForm').dispatchEvent(new Event('submit'));
                }
            });

            // Show tooltip on mandatory asterisk hover
            document.querySelectorAll('.mandatory').forEach(elem => {
                elem.title = '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö - ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ';
            });

            let params = new URLSearchParams(window.location.search);
            if (params.get('meCode')) {
                document.getElementById('meCode').value = params.get('meCode');
                searchPreviousData(true);
            }
        });

        // Handle remaining unsaved data
        function handleRemainData() {
            let inputs = $('input').toArray();
            let remainData = inputs.reduce((acc, input) => {
                const savedValue = localStorage.getItem('acceptance_record_' + input.name);
                acc[input.name] = savedValue;
                return acc;
            }, {});
            if (remainData['reminderToggle'] && remainData['reminderToggle'] === 'false' || (remainData['reminderToggle'] === 'true' && (!remainData['reminderDate'] && !remainData['reminderNote']))) {
                delete remainData['reminderToggle'];
                delete remainData['reminderDate'];
                delete remainData['reminderNote'];
                localStorage.removeItem('acceptance_record_reminderDate');
                localStorage.removeItem('acceptance_record_reminderNote');
                localStorage.removeItem('acceptance_record_reminderToggle');
            }
            let hasRemainData = Object.values(remainData).some(value => value !== null && value !== undefined && value !== '');
            if (hasRemainData) {
                Swal.fire({
                    title: '‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
                    text: '‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏£‡∏≠‡∏Å‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonText: '‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                    cancelButtonText: '‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£',
                    confirmButtonColor: '#10b981',
                    cancelButtonColor: '#ef4444',
                    customClass: { popup: 'rounded-3' }
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Restore data from localStorage
                        inputs.forEach(input => {
                            const savedValue = localStorage.getItem('acceptance_record_' + input.name);
                            if (savedValue) {
                                if (input.type === 'radio') {
                                    if (input.value === savedValue) {
                                        input.checked = true;
                                        $(input).trigger('input');
                                    }
                                } else if (input.type === 'checkbox') {
                                    if (savedValue === 'true') {
                                        input.checked = true;

                                    } else {
                                        input.checked = false;
                                    }
                                    toggleReminderContent();
                                    $(input).trigger('input');
                                }
                                else if (input._flatpickr) {
                                    input._flatpickr.setDate(savedValue);
                                    $(input).trigger('input');
                                } else {
                                    input.value = savedValue;
                                    $(input).trigger('input');
                                }
                            }
                        });
                        updateStats();
                    } else {

                        Swal.fire({
                            icon: 'question',
                            title: '‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
                            text: '‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö',
                            showCancelButton: true,
                            confirmButtonText: '‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                            cancelButtonText: '‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£',
                            confirmButtonColor: '#ef4444',
                            customClass: { popup: 'rounded-3' }
                        }).then((result) => {
                            if (result.isConfirmed) {
                                // Clear saved data
                                inputs.forEach(input => {
                                    localStorage.removeItem('acceptance_record_' + input.name);
                                });
                            } else {
                                handleRemainData()
                            }
                        });
                    }
                });
            }
        }

        // Show PDF button
        function showPDFButton() {
            const pdfBtn = document.querySelector('.btn-create-pdf');
            if (pdfBtn) {
                pdfBtn.style.display = 'flex';
                // Animate the button appearance
                pdfBtn.style.opacity = '0';
                pdfBtn.style.transform = 'scale(0.9)';
                setTimeout(() => {
                    pdfBtn.style.transition = 'all 0.3s ease';
                    pdfBtn.style.opacity = '1';
                    pdfBtn.style.transform = 'scale(1)';
                }, 10);
            }
        }

        // Create PDF File
        async function createPDFFile() {
            if (!pdfDoc) {
                Swal.fire({
                    icon: 'error',
                    title: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á PDF ‡πÑ‡∏î‡πâ',
                    text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
                    confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                    confirmButtonColor: '#ef4444',
                    customClass: { popup: 'rounded-3' }
                });
                return;
            }

            NProgress.start();

            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå PDF...',
                html: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ PDF',
                allowOutsideClick: false,
                customClass: { popup: 'rounded-3' },
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            try {
                await fillPDFForm();
                NProgress.done();
                Swal.close();

            } catch (error) {
                console.error('Error creating PDF:', error);
                NProgress.done();
                Swal.close();

                Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå PDF ‡πÑ‡∏î‡πâ: ' + error.message,
                    confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                    confirmButtonColor: '#ef4444',
                    customClass: { popup: 'rounded-3' }
                });
            }
        }

        // Fill PDF form with data
        async function fillPDFForm() {
            const pdfDocCopy = await PDFLib.PDFDocument.load(await pdfDoc.save());
            pdfDocCopy.registerFontkit(fontkit);
            const [font, symbolFont] = await Promise.all([
                pdfDocCopy.embedFont(fontBytes, { subset: true }),
                pdfDocCopy.embedFont(StandardFonts.ZapfDingbats, { subset: true })
            ]);
            const form = pdfDocCopy.getForm();

            try {
                // Get form data
                const formData = {
                    me_code: "CODE: " + document.getElementById('meCode').value.trim(),
                    manufacturer: document.getElementById('manufacturer').value,
                    vendor: document.getElementById('vendor').value,
                    date: moment(document.getElementById('date').value).format('DD/MM/YYYY'),
                    equipment: document.getElementById('equipment').value,
                    model: document.getElementById('model').value,
                    serial_number: document.getElementById('serialNumber').value,
                    quotation_no: document.getElementById('quotationNo').value,
                    invoice_no: document.getElementById('invoiceNo').value,
                    recorder: document.getElementById('recorder').value
                };

                // Fill PDF fields (adjust field names based on your PDF)
                const fieldMappings = {
                    'me_code': formData.me_code,
                    'manufacturer': formData.manufacturer,
                    'vendor': formData.vendor,
                    'date': formData.date,
                    'equipment': formData.equipment,
                    'model': formData.model,
                    'serial_number': formData.serial_number,
                    'quotation_no': formData.quotation_no,
                    'invoice_no': formData.invoice_no,
                    'recorder': formData.recorder
                };

                // Try to fill each field
                Object.keys(fieldMappings).forEach(fieldName => {
                    try {
                        const field = form.getTextField(fieldName);
                        if (field && fieldMappings[fieldName]) {
                            field.setText(String(fieldMappings[fieldName]));
                            field.updateAppearances(font);
                        }
                    } catch (e) {
                        console.warn(`Field ${fieldName} not found or error:`, e.message);
                    }
                });

                // Fill checklist items
                checklistItems.forEach((item, index) => {
                    const presentRadio = document.getElementById(`present_${item.no}`);
                    const absentRadio = document.getElementById(`absent_${item.no}`);
                    const remark = document.getElementById(`remark_${item.no}`).value;

                    // Try to fill checkbox fields (adjust field names based on your PDF)
                    try {
                        let checkBox
                        if (presentRadio && presentRadio.checked) {
                            checkBox = form.getTextField(`item_${item.no}_present`);
                            if (checkBox) checkBox.setText('‚úì')
                        } else if (absentRadio && absentRadio.checked) {
                            checkBox = form.getTextField(`item_${item.no}_absent`);
                            if (checkBox) checkBox.setText('‚úì')
                        }
                        checkBox.updateAppearances(symbolFont)
                    } catch (e) {
                        console.warn(`Checkbox field for item ${item.no} not found`);
                    }

                    // Try to fill remark field
                    try {
                        if (remark) {
                            const remarkField = form.getTextField(`remark_${item.no}`);
                            if (remarkField) remarkField.setText(remark);
                            remarkField.updateAppearances(font);
                        }
                    } catch (e) {
                        console.warn(`Remark field for item ${item.no} not found`);
                    }
                });

                // Flatten the form to make it non-editable
                form.flatten();

                // Save and download
                const pdfBytes = await pdfDocCopy.save();
                const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);

                // show download button
                $('#downloadFileContainer').removeClass('d-none').find('button').off('click').on('click', function () {
                    const a = document.createElement('a');
                    a.href = url
                    a.download = `Acceptance_Checklist_${formData.meCode || 'ME'}.pdf`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                });

                if (window.innerWidth < 768) {
                    window.open(url + '#toolbar=1?openExternalBrowser=true', '_blank')
                } else {

                    // Also show preview in iframe
                    const iframe = document.getElementById('pdf');
                    iframe.src = url;
                    iframe.style.display = 'block';

                }

                setTimeout(() => {
                    $('#downloadFileContainer')[0].scrollIntoView({ behavior: 'smooth' });
                }, 1000);

                // Clean up the URL after a delay
                setTimeout(() => URL.revokeObjectURL(url), 10000);

            } catch (error) {
                console.error('Error filling PDF form:', error);
                throw error;
            }
        }
    </script>
    <script>
        var pdfDoc
        var PDFDocument = PDFLib.PDFDocument;
        var StandardFonts = PDFLib.StandardFonts;
        var pdfFiles = []
        var fontBytes = []
        var font, symbolFont
        $(document).ready(async function () {
            NProgress.done();
            initPdfLib()
        });

        async function initPdfLib() {
            try {
                console.log('Initializing PDFLib...');

                // Load PDF and font in parallel
                const [pdfData, fontData] = await Promise.all([
                    fetch('./invent_form.pdf').then(res => res.arrayBuffer()),
                    fetch('../teampm/NotoSansThai_Condensed-Medium.ttf').then(res => res.arrayBuffer())
                ]);

                fontBytes = fontData;
                pdfDoc = await PDFDocument.load(pdfData);

                const form = pdfDoc.getForm();
                pdfDoc.registerFontkit(fontkit);
                // Embed fonts in parallel
                // [font, symbolFont] = await Promise.all([
                //     pdfDoc.embedFont(fontBytes, { subset: true }),
                //     pdfDoc.embedFont(StandardFonts.ZapfDingbats, { subset: true })
                // ]);

                // Get all fields in the PDF
                const fields = form.getFields();
                fields.forEach(field => {
                    const type = field.constructor.name;
                    const name = field.getName();
                    console.log(`${type}: ${name}`);
                });

                console.log('PDFLib initialized successfully');
            } catch (error) {
                console.error('Error initializing PDFLib:', error);
                Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå PDF ‡πÑ‡∏î‡πâ',
                    confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                    confirmButtonColor: '#ef4444'
                });
            }
        }
    </script>
    <script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>
    <script>
        // VConsole will be exported to `window.VConsole` by default.
        var vConsole = new window.VConsole();
    </script>
</body>

</html>