<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-control" content="no-cache , no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache , no-store">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js"
        integrity="sha512-pumBsjNRGGqkPzKHndZMaAG+bir374sORyzM3uulLV14lN5LyykqNk8eEeUlUkB3U0M4FApyaHraT65ihJhDpQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.4/font/bootstrap-icons.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Prompt&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" />
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Prompt', sans-serif;
            min-height: 100vh;
        }
    </style>
</head>

<body class="text-bg-dark d-flex align-items-center justify-centent-center">
    <main>
        <div class="container-fluid">
            <form id="mainform" class="row justify-content-center g-3">
                <div class="col-md-4">
                    <label for="code">รหัสเครื่อง (ใส่คอมม่าคั้น)</label>
                    <input type="text" class="form-control" id="code" name="code" placeholder="รหัสเครื่อง">
                </div>
                <div class="col-md-4">
                    <label for="vender">Vender</label>
                    <select name="vender" id="vender" class="form-select">
                        <option selected disabled>Select value</option>
                        <option>A.P.TEC(Thailand)co.,LTD</option>
                        <option>ABBOTT</option>
                        <option>Accord Corporation Limit</option>
                        <option>Advance Medical Esthetics (Thailand) CO,. LTD.</option>
                        <option>AESTHETICS FOCUS CORPORATION</option>
                        <option>AFTA</option>
                        <option>ALCON</option>
                        <option>ALLWELL</option>
                        <option>Asia Healthcare</option>
                        <option>Audimed Co., Ltd.</option>
                        <option>AUDIMED-LANE</option>
                        <option>B BRAUN</option>
                        <option>BABY GIFT</option>
                        <option>BAWMED</option>
                        <option>Baxter</option>
                        <option>BECTHAI BANGKOK EQUIPMENT &amp; CHEMICAL CO.,LTD.</option>
                        <option>BECTON DICKINSON CO.,Ltd.</option>
                        <option>BEMEPRO(Lasermed)</option>
                        <option>BIOACTIVE</option>
                        <option>BIOPLUS MEDICAL CO.,Ltd.</option>
                        <option>BIO-RAD</option>
                        <option>Bio-Rad Laboratories Ltd.</option>
                        <option>BIS</option>
                        <option>BJC</option>
                        <option>BJH Medical</option>
                        <option>CALIBRATION LABORATORY</option>
                        <option>CARESTREAM</option>
                        <option>CARLZEISS</option>
                        <option>CHUMROEN MEDICAL PRODUCTS CO.,LTD</option>
                        <option>CIRCLIFE</option>
                        <option>CONFIDENTIAL AND PROPRIETARY</option>
                        <option>Connect Diagnostics CO.,Ltd.</option>
                        <option>COOK Capital Equipment</option>
                        <option>Cosmed aesthetic</option>
                        <option>Demark Co., Ltd.</option>
                        <option>DENT-MATE</option>
                        <option>Department Of Medical Sciences</option>
                        <option>DKSH</option>
                        <option>DRAEGER</option>
                        <option>Drive Dental Incorporation Co.,Ltd.</option>
                        <option>E FOR L</option>
                        <option>EARTHLINE</option>
                        <option>EASMED</option>
                        <option>ELECTRONICS SOURCE</option>
                        <option>EMINENCE</option>
                        <option>ENDOMED</option>
                        <option>ENOVATION</option>
                        <option>Envision</option>
                        <option>EPPENDORF (Thailand) Co.,Ltd.</option>
                        <option>EQUIP HEALTHCARE</option>
                        <option>ESCO</option>
                        <option>Esco Lifesciences (Thailand) Co., Ltd.</option>
                        <option>EUROSCAN</option>
                        <option>FAMME WORKS</option>
                        <option>Fill tech</option>
                        <option>FRESENIUS</option>
                        <option>FUJIFILM</option>
                        <option>GATEWAY</option>
                        <option>GE HEALTHCARE</option>
                        <option>GETINGE</option>
                        <option>Getz Healthcare</option>
                        <option>GIBTHAI</option>
                        <option>Global Healthy Care</option>
                        <option>Grand Medical</option>
                        <option>Grandee International Co.,Ltd.</option>
                        <option>GUANGZHOU PLUSLIFE BIOTECH CO.,Ltd</option>
                        <option>HAUSEN BERNSTEIN CO.,LTD</option>
                        <option>Histocenter (Thailand) Co.,Ltd.</option>
                        <option>HOLLYWOOD</option>
                        <option>Hot Link</option>
                        <option>Idenmed</option>
                        <option>IDENT</option>
                        <option>IDS MED</option>
                        <option>IMS</option>
                        <option>INFOCUS FIRMING Co.,Ltd.</option>
                        <option>INNOTECH</option>
                        <option>Innovative Imaging Systems CO.,Ltd</option>
                        <option>INTER MEDICAL</option>
                        <option>INTER MEDICAL</option>
                        <option>ISO TECH</option>
                        <option>IVF</option>
                        <option>J SUMMIT</option>
                        <option>JF ADVANCE MED</option>
                        <option>Johnson &amp; Johnson</option>
                        <option>JS UNITECH CO.,Ltd.</option>
                        <option>K.C.ASSIST CO.,LTD.</option>
                        <option>KOSIN MEDICAL SUPPLY</option>
                        <option>LabIVF (Thailand) Limited</option>
                        <option>Laser Engineer Co.,Ltd</option>
                        <option>LASERMED</option>
                        <option>LIVA NOVA</option>
                        <option>LUNDAL(THAILAND) CO.,Ltd.</option>
                        <option>M D C (Thailand) Co.,Ltd.</option>
                        <option>M D C (THAILAND) CO.,LTD.</option>
                        <option>MAQUET</option>
                        <option>Martha Group Co.,Ltd.</option>
                        <option>MAX POWER SYSTEM CO., LTD.</option>
                        <option>MCAL</option>
                        <option>MEASUREMENTASIA</option>
                        <option>MEDFOCUS</option>
                        <option>MEDICA HEALTHCARE</option>
                        <option>Medica Healthcare</option>
                        <option>Medical Calibration Lab</option>
                        <option>MEDICAL LASER</option>
                        <option>Medical Solutions</option>
                        <option>Mediclife Co Ltd</option>
                        <option>MEDICOOL</option>
                        <option>MEDITOP</option>
                        <option>MED-ONE</option>
                        <option>MEDTRONIC</option>
                        <option>MEGAFIL</option>
                        <option>METTA MEDTECH</option>
                        <option>MIND MEDICAL CARE</option>
                        <option>MP GROUP (Thailand) CO.,LTD.</option>
                        <option>MUFFIN</option>
                        <option>NAMWIWAT MEDICAL</option>
                        <option>NEWLIFEMED</option>
                        <option>Noble Med Co.,Ltd.</option>
                        <option>NOVA GREEN POWER SYSTEM</option>
                        <option>NOVATEC</option>
                        <option>NSP Solution</option>
                        <option>OCTAX</option>
                        <option>OLYMPUS</option>
                        <option>OMNIMED</option>
                        <option>OMRON HEALTHCARE Co., Ltd.,</option>
                        <option>P.Diagnostics Co.,Ltd.</option>
                        <option>P.K. WATER TEXT LIMITED PARTNERSHIP</option>
                        <option>PARAMOUNT</option>
                        <option>PHATTHARAWIT HITECH CO.,LTD.</option>
                        <option>PHILIPS</option>
                        <option>PHOL DHANYA PUBLIC CO.,LTD.</option>
                        <option>Plenties Star</option>
                        <option>PNEUMAX</option>
                        <option>POF TECHNOLOGY</option>
                        <option>poolpan patana</option>
                        <option>PRIME MEDICAL</option>
                        <option>Prime Medical</option>
                        <option>QENZ MEDIC</option>
                        <option>QENZ MEDIC Co.L.td</option>
                        <option>QUANTUM</option>
                        <option>Quidel Ortho</option>
                        <option>R.X. Company</option>
                        <option>REHAB MEDICAL</option>
                        <option>REHAB MEDICAL</option>
                        <option>Ricco Service &amp; Supply</option>
                        <option>ROCHE</option>
                        <option>S.P. MEDICAL HUB LIMITED PARTNERSHIP</option>
                        <option>S.P. MEDICAL HUB LIMITED PARTNERSHIP</option>
                        <option>SAINT MED</option>
                        <option>SD Tantavade</option>
                        <option>SIAM MEDICAL SUPPLY</option>
                        <option>SIC MEDITECH</option>
                        <option>SIC MEDITECH</option>
                        <option>SIMM</option>
                        <option>SMIT MEDICAL LIMITED</option>
                        <option>SODEXO</option>
                        <option>South Medical Biotech Co.,Ltd</option>
                        <option>SP METROLOGY SYSTEM(THAILAND) CO.,LTD.</option>
                        <option>SPACEMED</option>
                        <option>SPK Plenties Star Co.,ltd</option>
                        <option>STANDARD MEDICAL SUPPLIES</option>
                        <option>Straumann Group(Thailand)Co .,Ltd</option>
                        <option>STRON CO.,LD.</option>
                        <option>Sysmex (Thailand) Co., Ltd.</option>
                        <option>TAWANMCWEIS</option>
                        <option>TECHNO MEDICAL</option>
                        <option>TECHNO MEDICAL</option>
                        <option>TECHNOLOGY PROMOTION ASSOCIATION(THAILAND-JAPAN)</option>
                        <option>TECHNOLOGY PROMOTION ASSOCIATION(THAILAND-JAPAN)</option>
                        <option>TEQ</option>
                        <option>Terumo</option>
                        <option>THAI GL Co.,Ltd.</option>
                        <option>Thai Ur Kang</option>
                        <option>Thanes Developmant Co.,Ltd.</option>
                        <option>THONBULI OXIGEN</option>
                        <option>TNC MEDDITRON</option>
                        <option>TOP</option>
                        <option>TOPCON</option>
                        <option>TRB Chemedica (Thailand)Ltd</option>
                        <option>TREAT MED</option>
                        <option>Treat Med Company Limited</option>
                        <option>UB (Thailand) CO.,LTD</option>
                        <option>UDOM MEDICAL</option>
                        <option>UFAM</option>
                        <option>ULTRALAB CO.,LTD</option>
                        <option>UNITECH</option>
                        <option>VALOR</option>
                        <option>VITROLIFE</option>
                        <option>WATECH</option>
                        <option>Wellgate A.D.Tech Co.,Ltd.</option>
                        <option>XOVIC</option>
                        <option>ZEPPER</option>
                        <option>ZESTMED</option>
                        <option>ZIMMER</option>
                        <option>Zimmer Biomet</option>
                        <option>Z-medic Co.,Ltd</option>
                        <option>ZUELLING PHARMA</option>
                        <option>อินทิเกรทเต็ด เมดิคอล เซอร์วิส</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="date">วันที่</label>
                    <input type="date" class="form-control" id="date" name="date">
                </div>
                <div class="col-md-4">
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" value="" id="safety" name="safety">
                        <label class="form-check-label" for="safety">
                            Electrical Safety Analyzer
                        </label>
                    </div>
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" value="" id="is_pm" name="is_pm" checked>
                        <label class="form-check-label" for="is_pm">
                            Close PM
                        </label>
                    </div>
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" value="" id="is_cal" name="is_cal">
                        <label class="form-check-label" for="is_cal">
                            Close CAL
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="is_team_cal" name="is_team_cal">
                        <label class="form-check-label" for="is_cal">
                            Team CAL
                        </label>
                    </div>
                </div>
                <div class="col-md-4 text-center">
                    <button class="btn btn-primary w-100" type="submit">ตกลง</button>
                </div>

            </form>
        </div>
    </main>
    <script>
        $(document).ready(function () {
            const liff_id = '1657539607-0RQnQ4zW'
            liff.init({
                liffId: liff_id,
                withLoginOnExternalBrowser: true
            })
            liff.ready.then(() => {
                $('#vender').select2({
                    theme: 'bootstrap-5',
                    width: '100%',
                    closeOnSelect: true,
                    tags: true,
                }).on('select2:selecting', function (e) {
                    let inputValue = e.params.args.data.text;
                    let optionValue = inputValue.toLowerCase().replace(/\s+/g, '-');

                    // Create a new option element
                    let newOption = new Option(inputValue, optionValue, true, true);

                    // Append the new option to the select element
                    $(this).append(newOption).trigger('change');
                });
                $(document).on('select2:open', () => {
                    document.querySelector('.select2-search__field').focus();
                });
            })
        })
        $('#mainform').submit(async function (e) {
            e.preventDefault()
            let code = $('#code').val()
            let vender = $('#vender').val()
            let date = $('#date').val()
            let safety = $('#safety').is(':checked') ? 'safety' : undefined
            let close_pm = $('#is_pm').is(':checked')
            let close_cal = $('#is_cal').is(':checked')
            date = date.split('-').reverse().join('/')
            let tmp = code
            code = code.split(',').map(a => a.trim())
            if(code === tmp || code[0] === tmp){
                code = tmp.split(' ').map(a => a.trim())
            }
            if ((vender == null || vender == '') && !$('#is_team_cal').is(':checked')) {
                return Swal.fire({
                    title: 'กรุณาเลือก Vender',
                    icon: 'error',
                    showConfirmButton: false,
                    timer: 1500
                }).then(() => {
                    setTimeout(() => {
                        $('#vender').select2('open')
                    }, 1000);
                })
            }
            if (!close_pm && !close_cal) {
                return Swal.fire({
                    title: 'กรุณาเลือกประเภทการปิดงาน',
                    icon: 'error',
                    showConfirmButton: false,
                    timer: 1500
                })
            }
            if ($('#is_team_cal').is(':checked')) {
                vender = '[[CAL]]'
            }else{
                vender = vender.split(',')[0]
            }
            for (let c of code) {
                Swal.fire({
                    title: c,
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading()
                    }
                })
                let mode = close_pm && close_cal ? 'closepmcal' : close_pm ? 'closepm' : 'closecal'
                let msg = mode + '=' + c + ',' + vender  //+ ',' + date + ',' + safety
                if (date != null && date != '') {
                    msg += ',' + date
                }
                if (safety != null && safety != '') {
                    msg += ',' + safety
                }
                await new Promise((resolve, reject) => setTimeout(() => resolve(), 700)).then(() => {
                    liff.sendMessages([{
                        'type': 'text',
                        'text': msg
                    }]).then(() => {
                        console.log('message sent')
                    }).catch((err) => {
                        console.log('error', err)
                    })
                    // $('body').append(msg + '<br>')
                })
                if (c == code[code.length - 1]) {
                    Swal.fire({
                        title: 'เสร็จสิ้น',
                        icon: 'success',
                        showConfirmButton: false,
                        timer: 1500
                    }).then(() => {
                        liff.closeWindow()
                    })
                }
            }
        })
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/gasparesganga-jquery-loading-overlay@2.1.7/dist/loadingoverlay.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.full.min.js"></script>
</body>

</html>