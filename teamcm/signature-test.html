<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Signature Test - Blue Pen & SVG</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
    <style>
        .signature-canvas {
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: crosshair;
        }
        .signature-preview {
            border: 1px solid #ccc;
            min-height: 200px;
            padding: 10px;
            background: #f9f9f9;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">Signature Test - Blue Pen & SVG</h1>
        
        <div class="row">
            <div class="col-md-6">
                <h3>Draw Signature</h3>
                <canvas id="signatureCanvas" width="400" height="200" class="signature-canvas"></canvas>
                <div class="mt-3">
                    <button id="clearBtn" class="btn btn-warning">Clear</button>
                    <button id="saveBtn" class="btn btn-primary">Save as SVG</button>
                </div>
            </div>
            <div class="col-md-6">
                <h3>Recreated from Coordinates</h3>
                <div id="svgPreview" class="signature-preview"></div>
                <div class="mt-3">
                    <small class="text-muted">Signature recreated from coordinate data</small>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <h4>Coordinate Data (for Database Storage):</h4>
                <textarea id="svgCode" class="form-control" rows="10" readonly placeholder="Coordinate data will appear here..."></textarea>
                <div class="mt-2">
                    <small class="text-success">This compact data can recreate the signature perfectly and uses 90%+ less storage than images!</small>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize signature pad
        const canvas = document.getElementById('signatureCanvas');
        const signaturePad = new SignaturePad(canvas, {
            backgroundColor: 'rgba(255,255,255,1)',
            penColor: '#1212ff', // Bright blue pen color
            minWidth: 1,
            maxWidth: 3,
            throttle: 16
        });

        // Clear button
        document.getElementById('clearBtn').addEventListener('click', function() {
            signaturePad.clear();
            document.getElementById('svgPreview').innerHTML = '';
            document.getElementById('svgCode').value = '';
        });

        // Save button
        document.getElementById('saveBtn').addEventListener('click', function() {
            if (signaturePad.isEmpty()) {
                alert('Please draw a signature first');
                return;
            }

            // Get coordinate data (minimal storage)
            const coordinateData = {
                points: signaturePad.toData(),
                width: canvas.offsetWidth,
                height: canvas.offsetHeight,
                penColor: '#1212ff'
            };
            
            // Convert to compact JSON string
            const compactData = JSON.stringify(coordinateData);
            
            // Recreate signature from coordinates
            const recreatedCanvas = document.createElement('canvas');
            recreatedCanvas.width = coordinateData.width;
            recreatedCanvas.height = coordinateData.height;
            const recreatedPad = new SignaturePad(recreatedCanvas, {
                penColor: coordinateData.penColor
            });
            recreatedPad.fromData(coordinateData.points);
            
            // Display recreated signature
            document.getElementById('svgPreview').innerHTML = '';
            document.getElementById('svgPreview').appendChild(recreatedCanvas);
            document.getElementById('svgCode').value = compactData;
            
            console.log('Coordinate Data Size:', compactData.length, 'bytes');
            console.log('SVG Size:', signaturePad.toSVG().length, 'bytes');
            console.log('DataURL Size:', signaturePad.toDataURL().length, 'bytes');
            console.log('Compression Ratio:', Math.round((1 - compactData.length / signaturePad.toDataURL().length) * 100) + '%');
        });

        // Auto-resize canvas
        function resizeCanvas() {
            const ratio = Math.max(window.devicePixelRatio || 1, 1);
            canvas.width = canvas.offsetWidth * ratio;
            canvas.height = canvas.offsetHeight * ratio;
            canvas.getContext('2d').scale(ratio, ratio);
            signaturePad.clear();
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
    </script>
</body>
</html>